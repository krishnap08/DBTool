<script name="EmpDepCombo" />
    <script name="BenCombo" />
  
<event name="onLoad" where="Server">
<!-- The following block is for using a different where condition when the form is run under ESS -->
<if xml="Run">
<when>
<eq>
<val>[F_Application]</val>
<val>ESS</val>
</eq>
</when>
<then>
<set var="[F_NavPfind]">
<eq xml="keep">
<fld name="Emp.Emp"/>
<val>[S_SecEmp]</val>
</eq>
</set>
</then>
</if>
</event>
<!-- Server Side Event Handling Block Ends -->
<!-- Event Handling Block Ends -->
<!-- Dataset Definition Block Starts -->
<!--
# 47409-LM-NV: Main Dataset Modified To Handle Multiple Eml
# Eml table added into the dataset to group the records by Eml
# Condition EmpEnrSum.Emp = Eml.Eml added for multiple Eml
# Join with PayGrp and Job table added to display in the header
# Field added to sort the records by Eml.Eml
-->
    
    <dataset name="main">
      <tables>
        <tbl name="Emp" />
        
        <tbl name="Eml" join="LEFT" to="Emp">
          <and>
            <eq>
              <fld name="Emp.Emp"/>
              <fld name="Eml.Emp"/>
            </eq>
            <isnull>
              <fld name="Eml.EmlEfdDt" />
            </isnull>
          </and>
        </tbl>
        <tbl name="EmpBen" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="Eml.Emp" />
              <fld name="EmpBen.Emp" />
            </eq>
            <eq>
              <fld name="Eml.Eml" />
              <fld name="EmpBen.Eml" />
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <eq>
            <fld name="Ben.Ben" />
            <fld name="EmpBen.Ben" />
          </eq>
        </tbl>
        <tbl name="EnrSum" join="LEFT">
          <eq>
            <fld name="Ben.EnrSum" />
            <fld name="EnrSum.EnrSum" />
          </eq>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="BenPln.PlanType" />
            <fld name="PlnTyp.PlnTyp" />
          </eq>
        </tbl>
        
        <tbl name="Job" join="LEFT" to="Eml">
          <and>
            <eq>
              <fld name="Eml.Job"/>
              <fld name="Job.Job"/>
            </eq>
            <isnull>
              <fld name="Job.JobEfdDt"/>
            </isnull>
          </and>
        </tbl>
        <tbl name="PayGrp" join="LEFT" to="Eml">
          <and>
            <eq>
              <fld name="Eml.PayGrp"/>
              <fld name="PayGrp.PayGrp"/>
            </eq>
            <isnull>
              <fld name="PayGrp.PayGrpEfdDt"/>
            </isnull>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpBen.*" />
        <fld name="EmpBen.Eml" />
        <fld name="EnrSum.EnrSum" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00'+CONVERT(nVarChar(15),PlnTyp.PlnOrd),3)
            ]]>
          </native>
        </fld>
        <fld name="PlnTyp.PlnTypName" />
        <fld name="PlnTyp.PlnTypDesc" />
        <fld name="Ben.BenName" />
        <fld name="Ben.BenStartDt" />
        <fld name="Ben.IsEmpPremEmpAmt" />
        <fld name="Ben.IsEmpCovEmpAmt" />
        <fld name="Ben.IsCmpPremEmpAmt" />
        <fld name="Ben.IsCmpCovEmpAmt" />
        <fld name="Ben.IsTotPremEmpAmt" />
        <fld name="Ben.IsTotCovEmpAmt" />
        <fld name="Ben.IsFlxCrdEmpAmt" />
        <fld name="EnrSum.EnrStartDt" />
        <fld name="EnrSum.EnrEndDt" />
        <fld name="Ben.BenDesc" />
        <fld name="BenPln.DescLnk" />
        <fld name="BenPln.InsCar" />
        <fld name="BenPln.FSAAllow" />
        <fld name="BenPln.FSADepAllow" />
        <fld name="Ben.DepAllow" />
        <fld name="Ben.BenAllow" />
        <fld name="BenPln.ClmAllow" />
        <fld name="BenPln.UntAllow" />
        <fld name="BenPln.PCPAllow" />
        
        <fld name="BenPln.DedPayCde" />
        <fld name="EmpName">
          <append>
            <fld name="Emp.LastName" type="String" />
            <val>, </val>
            <fld name="Emp.FirstName" type="String" />
          </append>
        </fld>
        <script name="EmpHeaderFlds" />
        
        <script name="EmlHeaderFlds"/>
      </display>
      <where>
        <and>
          <le>
            <fld name="EnrStartDt" type="datetime" />
            <val>[Date]</val>
          </le>
          <ge>
            <fld name="EnrEndDt" type="datetime" />
            <val>[Date]</val>
          </ge>
          <or>
            <isnull>
              <fld name="EmpBenEfdDt" />
            </isnull>
            <ge>
              <fld name="EmpBenEfdDt" type="datetime" />
              <val>[Date]</val>
            </ge>
          </or>
        </and>
      </where>
      <order>
        <fld name="EmpBen.Emp" />
        <fld name="Ben.EnrSum" />
        
        <fld name="EmlVal" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBen.Ben" />
      </order>
      <includehistory>Yes</includehistory>
    </dataset>
    <dataset name="Dep">
      <tables>
        <tbl name="EmpDep" />
        <tbl name="EmpBen" join="RIGHT" to="EmpDep">
         <and>
		<eq>
		<fld name="EmpDep.Emp" />
		<fld name="EmpBen.Emp" />
		</eq>
		<or>
		<isnull>
		<fld name="EmpBen.EmpBenEfdDt" />
		</isnull>
		<eq>
		<fld name="EmpBen.EmpBenEfdDt" />
		 <val>[Date]</val>
		</eq>
		</or>
		</and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <eq>
            <fld name="Ben.Ben" />
            <fld name="EmpBen.Ben" />
          </eq>
        </tbl>
        <tbl name="EnrSum" join="LEFT">
          <eq>
            <fld name="Ben.EnrSum" />
            <fld name="EnrSum.EnrSum" />
          </eq>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="PlnTyp.PlnTyp" />
            <fld name="BenPln.PlanType" />
          </eq>
        </tbl>
        <tbl name="EmpBenDep" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="EmpBenDep.Emp" />
              <fld name="EmpBen.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenDep.Ben" />
              <fld name="EmpBen.Ben" />
            </eq>
            <eq>
              <fld name="EmpBenDep.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenDep.Dep" />
              <fld name="EmpDep.Dep" />
            </eq>
            <eq>
              <fld name="EmpDep.Dependent" type="YesNo" />
              <val type="YesNo">Yes</val>
            </eq>
            <eq>
              <fld name="EmpDep.BenPart" type="YesNo" />
              <val type="YesNo">Yes</val>
            </eq>
			<or>
            <eq>
              <fld name="EmpBenDep.EmpBenDepEfdDt" type="DateTime" />
              <val />
            </eq>
			 <eq>
              <fld name="EmpBenDep.EmpBenDepEfdDt"/>
			  <fld name="EmpBen.EmpBenEndDt" />             
            </eq>
			</or>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpDep.Emp" />
        <fld name="EnrSum.EnrSum" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00'+CONVERT(nVarChar(15),PlnTyp.PlnOrd),3)
            ]]>
          </native>
        </fld>
        <fld name="EmpBen.Eml" />
        <fld name="EmpBen.Ben" />
        <fld name="EmpDep.Dep" />
		<fld name="EmpBen.EmpBenEfdDt" />
        <fld name="DepPhysician" />
        <fld name="EmpBenDepEffDt" />
        <fld name="EmpBenDepEfdDt" />
        <fld name="DepBenStartDt" />
        <fld name="DepBenEndDt" />
        <fld name="EmpBenDep.EmpBenDepId" />
        <fld name="EmpBenDep.EmpBenDepDt" />
        <fld name="DepName">
          <append>
            <fld name="EmpDep.DepLastName" type="String" />
            <val>, </val>
            <fld name="EmpDep.DepFirstName" type="String" />
          </append>
        </fld>
        <fld name="DepSelect">
          <native lang="SQLServer">
            <![CDATA[
              CASE WHEN NOT EmpBenDep.Dep IS NULL AND (EmpBenDep.EmpBenDepEfdDt IS NULL OR  EmpBenDep.EmpBenDepEfdDt = EmpBen.EmpBenEndDt) THEN 'Yes'
                   ELSE 'No' END
            ]]>
          </native>
        </fld>
      </display>
      <where>
        <and xml="keep">
          <or>
            <isnull>
              <fld name="EmpBenEfdDt" />
            </isnull>
            <ge>
              <fld name="EmpBenEfdDt" type="datetime" />
              <val>[Date]</val>
            </ge>
          </or>
          <le>
            <fld name="EnrStartDt" type="datetime" />
            <val>[Date]</val>
          </le>
          <ge>
            <fld name="EnrEndDt" type="datetime" />
            <val>[Date]</val>
          </ge>
          <eq>
            <fld name="EmpDep.Emp" type="String" />
            <val>[fld_main.Emp]</val>
          </eq>
          <eq>
            <fld name="EmpDep.Dependent" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="EmpDep.BenPart" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="Ben.DepAllow" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="DepSelect">
              <native lang="SQLServer">
                  CASE WHEN NOT EmpBenDep.Dep IS NULL AND ( EmpBenDep.EmpBenDepEfdDt IS NULL OR  EmpBenDep.EmpBenDepEfdDt = EmpBen.EmpBenEndDt) THEN 'Yes' ELSE 'No' END 
                </native>
            </fld>
            <val type="String">Yes</val>
          </eq>
        </and>
      </where>
      <order>
        <fld name="EmpBen.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBen.Ben" />
        <fld name="EmpDep.Dep" />
      </order>
      <synchronize dataset="main" >
        <if> 
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Dep.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Dep.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Dep.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Dep.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Dep.Ben]</val>
              </eq>
			  <eq>
            <val>[fld_main.EmpBenEfdDt]</val>
            <val>[fld_Dep.EmpBenEfdDt]</val>
          </eq>
            </and>
          </when>
          <then>Keep</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Dep.Emp]</val>
              </eq>
              <gt>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Dep.EnrSum]</val>
              </gt>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Dep.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Dep.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Dep.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Skip</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Dep.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Dep.EnrSum]</val>
              </eq>
              <gt>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Dep.PlnOrd]</val>
              </gt>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Dep.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Dep.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Skip</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Dep.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Dep.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Dep.PlnOrd]</val>
              </eq>
              <gt>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Dep.PlnTyp]</val>
              </gt>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Dep.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Skip</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Dep.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Dep.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Dep.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Dep.PlnTyp]</val>
              </eq>
              <gt>
                <val>[fld_main.Ben]</val>
                <val>[fld_Dep.Ben]</val>
              </gt>
            </and>
          </when>
          <then>Skip</then>
          <else>Stop</else>
        </if>
      </synchronize>
      <includehistory>Yes</includehistory>
    </dataset>

    <dataset name="Bnf">
      <tables>
        <tbl name="EmpDep" />
        <tbl name="EmpBen" join="RIGHT" to="EmpDep">
          <eq>
            <fld name="EmpDep.Emp" />
            <fld name="EmpBen.Emp" />
          </eq>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <eq>
            <fld name="Ben.Ben" />
            <fld name="EmpBen.Ben" />
          </eq>
        </tbl>
        <tbl name="EnrSum" join="LEFT">
          <eq>
            <fld name="Ben.EnrSum" />
            <fld name="EnrSum.EnrSum" />
          </eq>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="PlnTyp.PlnTyp" />
            <fld name="BenPln.PlanType" />
          </eq>
        </tbl>
        <tbl name="EmpBenBnf" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="EmpBenBnf.Emp" />
              <fld name="EmpBen.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenBnf.Ben" />
              <fld name="EmpBen.Ben" />
            </eq>
            <eq>
              <fld name="EmpBenBnf.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenBnf.BnfNum" />
              <fld name="EmpDep.Dep" />
            </eq>
            <eq>
              <fld name="EmpDep.Beneficiary" type="YesNo" />
              <val type="YesNo">Yes</val>
            </eq>
        <or>
            <eq>
              <fld name="EmpBenBnf.EmpBenBnfEfdDt" type="DateTime" />
              <val />
            </eq>
          <ge>
            <fld name="EmpBenBnf.EmpBenBnfEfdDt" type="DateTime" />
            <val>[Date]</val>
          </ge>
        </or>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpDep.Emp" />
        <fld name="EmpBen.Eml" />
        <fld name="EmpBen.Ben" />
        <fld name="EmpBen.EmpBenEffDt" />
        <fld name="EmpDep.Dep" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00'+CONVERT(nVarChar(15),PlnTyp.PlnOrd),3)
            ]]>
          </native>
        </fld>
        <fld name="EnrSum.EnrSum" />
        <fld name="BnfPct" />
        <fld name="Contingency" />
        <fld name="EmpBenBnfEfdDt" />
        <fld name="EmpBenBnf.EmpBenBnfId" />
        <fld name="EmpBenBnf.EmpBenBnfDt" />
        <fld name="EmpBenBnf.BnfNum" />
        <fld name="BnfName">
          <append>
            <fld name="EmpDep.DepLastName" type="String" />
            <val>, </val>
            <fld name="EmpDep.DepFirstName" type="String" />
          </append>
        </fld>
        <fld name="BnfSelect">
          <native lang="SQLServer">
            <![CDATA[
              CASE WHEN NOT EmpBenBnf.BnfNum IS NULL AND ( EmpBenBnf.EmpBenBnfEfdDt IS NULL OR EmpBenBnf.EmpBenBnfEfdDt  >= GetDate())
                   THEN 'Yes' ELSE 'No' END 
            ]]>
          </native>
        </fld>
      </display>
      <where>
        <and>
          <or>
            <isnull>
              <fld name="EmpBenEfdDt" />
            </isnull>
            <ge>
              <fld name="EmpBenEfdDt" type="datetime" />
              <val>[Date]</val>
            </ge>
          </or>
          <le>
            <fld name="EnrStartDt" type="datetime" />
            <val>[Date]</val>
          </le>
          <ge>
            <fld name="EnrEndDt" type="datetime" />
            <val>[Date]</val>
          </ge>
          <eq>
            <fld name="EmpDep.Emp" type="String" />
            <val>[fld_main.Emp]</val>
          </eq>
          <eq>
            <fld name="EmpDep.Beneficiary" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="Ben.BenAllow" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="BnfSelect">
              <native lang="SQLServer">
                  CASE WHEN NOT EmpBenBnf.BnfNum IS NULL AND ( EmpBenBnf.EmpBenBnfEfdDt IS NULL OR EmpBenBnf.EmpBenBnfEfdDt  &gt;= GetDate()) THEN 'Yes' ELSE 'No' END 
                </native>
            </fld>
            <val type="String">Yes</val>
          </eq>
        </and>
      </where>
      <order>
        <fld name="EmpBen.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBen.Ben" />
        <fld name="EmpDep.Dep" />
      </order>
      <synchronize dataset="main">
        <if>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Bnf.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Bnf.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Bnf.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Keep</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
              <gt>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </gt>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Bnf.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Bnf.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Bnf.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Skip</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </eq>
              <gt>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Bnf.PlnOrd]</val>
              </gt>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Bnf.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Bnf.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Skip</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Bnf.PlnOrd]</val>
              </eq>
              <gt>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Bnf.PlnTyp]</val>
              </gt>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Bnf.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Skip</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Bnf.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Bnf.PlnTyp]</val>
              </eq>
              <gt>
                <val>[fld_main.Ben]</val>
                <val>[fld_Bnf.Ben]</val>
              </gt>
            </and>
          </when>
          <then>Skip</then>
          <else>Stop</else>
        </if>
      </synchronize>
      <includehistory>Yes</includehistory>
    </dataset>

    
    <dataset name="PendBen">
      <tables>
        <tbl name="Emp" />
        <tbl name="EmpBenElg" join="RIGHT" to="Emp">
          <and>
            <eq>
              <fld name="Emp.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <isnull>
              <fld name="EmpBenElg.EmpBenElgEfdDt" />
            </isnull>
            <eq>
              <fld name="EmpBenElg.Chosen" type="YesNo" />
              <val>Yes</val>
            </eq>
            <eq>
              <fld name="EmpBenElg.PendBen" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <eq>
            <fld name="Ben.Ben" />
            <fld name="EmpBenElg.Ben" />
          </eq>
        </tbl>
        <tbl name="EnrSum" join="LEFT">
          <eq>
            <fld name="Ben.EnrSum" />
            <fld name="EnrSum.EnrSum" />
          </eq>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="BenPln.PlanType" />
            <fld name="PlnTyp.PlnTyp" />
          </eq>
        </tbl>
      </tables>
      <display>
        <fld name="EmpBenElg.*" />
        <fld name="EnrSum.EnrSum" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00' + CONVERT(nVarChar(15), PlnTyp.PlnOrd), 3)
            ]]>
          </native>
        </fld>
        <fld name="PlnTyp.PlnTypName" />
        <fld name="PlnTyp.PlnTypDesc" />
        <fld name="Ben.BenName" />
        <fld name="Ben.BenStartDt" />
        <fld name="Ben.IsEmpPremEmpAmt" />
        <fld name="Ben.IsEmpCovEmpAmt" />
        <fld name="Ben.IsCmpPremEmpAmt" />
        <fld name="Ben.IsCmpCovEmpAmt" />
        <fld name="Ben.IsTotPremEmpAmt" />
        <fld name="Ben.IsTotCovEmpAmt" />
        <fld name="Ben.IsFlxCrdEmpAmt" />
        <fld name="EnrSum.EnrStartDt" />
        <fld name="EnrSum.EnrEndDt" />
        <fld name="Ben.BenDesc" />
        <fld name="BenPln.DescLnk" />
        <fld name="BenPln.InsCar" />
        <fld name="BenPln.FSAAllow" />
        <fld name="BenPln.FSADepAllow"/>
        <fld name="Ben.DepAllow" />
        <fld name="Ben.BenAllow" />
        <fld name="BenPln.ClmAllow" />
        <fld name="BenPln.UntAllow" />
        <fld name="BenPln.PCPAllow" />
      </display>
      <where>
        <and>
          <le>
            <fld name="EnrStartDt" type="datetime" />
            <val>[Date]</val>
          </le>
          <ge>
            <fld name="EnrEndDt" type="datetime" />
            <val>[Date]</val>
          </ge>
        </and>
      </where>
      <pfind>[F_NavPfind]</pfind>
      <order>
        <fld name="EmpBenElg.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBenElg.Ben" />
      </order>
      <includehistory>Yes</includehistory>
    </dataset>


    <dataset name="PendBenDep">
      <tables>
        <tbl name="EmpDep" />
        <tbl name="EmpBenElg" join="RIGHT" to="EmpDep">
          <and>
            <eq>
              <fld name="EmpDep.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <isnull>
              <fld name="EmpBenElg.EmpBenElgEfdDt" />
            </isnull>
            <eq>
              <fld name="EmpBenElg.Chosen" type="YesNo" />
              <val>Yes</val>
            </eq>
            <eq>
              <fld name="EmpBenElg.PendBen" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <eq>
            <fld name="Ben.Ben" />
            <fld name="EmpBenElg.Ben" />
          </eq>
        </tbl>
        <tbl name="EnrSum" join="LEFT">
          <eq>
            <fld name="Ben.EnrSum" />
            <fld name="EnrSum.EnrSum" />
          </eq>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="PlnTyp.PlnTyp" />
            <fld name="BenPln.PlanType" />
          </eq>
        </tbl>
        <tbl name="EmpBenElgDep" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="EmpBenElgDep.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgDep.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="EmpBenElgDep.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgDep.Dep" />
              <fld name="EmpDep.Dep" />
            </eq>
            <eq>
              <fld name="EmpDep.Dependent" type="YesNo"/>
              <val type="YesNo" >Yes</val>
            </eq>
            <eq>
              <fld name="EmpDep.BenPart" type="YesNo"/>
              <val type="YesNo" >Yes</val>
            </eq>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpDep.Emp" />
        <fld name="EmpBenElg.Eml" />
        <fld name="EnrSum.EnrSum" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00' + CONVERT(nVarChar(15), PlnTyp.PlnOrd), 3)
            ]]>
          </native>
        </fld>
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
        <fld name="DepPhysician" />
        <fld name="EmpBenElgDepEffDt" />
        <fld name="EmpBenElgDepEfdDt" />
        <fld name="DepBenStartDt" />
        <fld name="DepBenEndDt" />
        <fld name="EmpBenElgDep.EmpBenElgDepId" />
        <fld name="EmpBenElgDep.EmpBenElgDepDt" />
        <fld name="DepName">
          <append>
            <fld name="EmpDep.DepLastName" type="String" />
            <val>, </val>
            <fld name="EmpDep.DepFirstName" type="String" />
          </append>
        </fld>
        <fld name="DepSelect">
          <native lang="SQLServer">CASE WHEN NOT EmpBenElgDep.Dep IS NULL AND EmpBenElgDep.EmpBenElgDepEfdDt IS NULL THEN 'Yes' ELSE 'No' END</native>
        </fld>
       </display>
       <where>
         <and xml="keep">
           <le>
             <fld name="EnrStartDt" type="datetime" />
             <val>[Date]</val>
           </le>
           <ge>
             <fld name="EnrEndDt" type="datetime" />
             <val>[Date]</val>
           </ge>
           <eq>
             <fld name="EmpDep.Emp" type="String"/>
             <val>[fld_PendBen.Emp]</val>
           </eq>
           <eq>
             <fld name="EmpDep.Dependent" type="YesNo"/>
             <val type="YesNo" >Yes</val>
           </eq>
           <eq>
             <fld name="EmpDep.BenPart" type="YesNo"/>
             <val type="YesNo" >Yes</val>
           </eq>
           <eq>
             <fld name="Ben.DepAllow" type="YesNo"/>
             <val type="YesNo" >Yes</val>
           </eq>
           <notnull><fld name="EmpBenElgDepId" /></notnull>
          </and>
       </where>
      <order>
        <fld name="EmpBenElg.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
      </order>
      <synchronize dataset="PendBen">
        <if>
          <when>
            <and>
              <eq>
                <val>[fld_PendBen.Emp]</val>
                <val>[fld_PendBenDep.Emp]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.EnrSum]</val>
                <val>[fld_PendBenDep.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.PlnOrd]</val>
                <val>[fld_PendBenDep.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.PlnTyp]</val>
                <val>[fld_PendBenDep.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.Ben]</val>
                <val>[fld_PendBenDep.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Keep</then>
          <when>
            <and>
              <eq>
                <val>[fld_PendBen.Emp]</val>
                <val>[fld_PendBenDep.Emp]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.EnrSum]</val>
                <val>[fld_PendBenDep.EnrSum]</val>
              </eq>
              <or>
                <ne>
                  <val>[fld_PendBen.PlnOrd]</val>
                  <val>[fld_PendBenDep.PlnOrd]</val>
                </ne>
                <ne>
                  <val>[fld_PendBen.PlnTyp]</val>
                  <val>[fld_PendBenDep.PlnTyp]</val>
                </ne>
                <ne>
                  <val>[fld_PendBen.Ben]</val>
                  <val>[fld_PendBenDep.Ben]</val>
                </ne>
              </or>
            </and>
          </when>
          <then>Stop</then>
          <else>Skip</else>
        </if>
      </synchronize>
      <includehistory>Yes</includehistory>
    </dataset>
    <dataset name="PendBenBnf">
      <tables>
        <tbl name="EmpDep" />
        <tbl name="EmpBenElg" join="RIGHT" to="EmpDep">
          <and>
            <eq>
              <fld name="EmpDep.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <isnull>
              <fld name="EmpBenElg.EmpBenElgEfdDt" />
            </isnull>
            <eq>
              <fld name="EmpBenElg.Chosen" type="YesNo" />
              <val>Yes</val>
            </eq>
            <eq>
              <fld name="EmpBenElg.PendBen" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <eq>
            <fld name="Ben.Ben" />
            <fld name="EmpBenElg.Ben" />
          </eq>
        </tbl>
        <tbl name="EnrSum" join="LEFT">
          <eq>
            <fld name="Ben.EnrSum" />
            <fld name="EnrSum.EnrSum" />
          </eq>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="PlnTyp.PlnTyp" />
            <fld name="BenPln.PlanType" />
          </eq>
        </tbl>
        <tbl name="EmpBenElgBnf" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="EmpBenElgBnf.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgBnf.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="EmpBenElgBnf.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgBnf.BnfNum" />
              <fld name="EmpDep.Dep" />
            </eq>
            <eq>
              <fld name="EmpDep.Beneficiary" type="YesNo" />
              <val type="YesNo" >Yes</val>
            </eq>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpDep.Emp" />
        <fld name="EmpBenElg.Eml" />
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00' + CONVERT(nVarChar(15), PlnTyp.PlnOrd), 3)
            ]]>
          </native>
        </fld>
        <fld name="EnrSum.EnrSum" />
        <fld name="BnfPct" />
        <fld name="Contingency" />
        <fld name="EmpBenElgBnfEfdDt" />
        <fld name="EmpBenElgBnf.EmpBenElgBnfId" />
        <fld name="EmpBenElgBnf.EmpBenElgBnfDt" />
        <fld name="EmpBenElgBnf.BnfNum" />
        <fld name="BnfName">
          <append>
            <fld name="EmpDep.DepLastName" type="String" />
            <val>, </val>
            <fld name="EmpDep.DepFirstName" type="String" />
          </append>
        </fld>
        <fld name="BnfSelect">
          <native lang="SQLServer">
            CASE WHEN NOT EmpBenElgBnf.BnfNum IS NULL AND EmpBenElgBnf.EmpBenElgBnfEfdDt IS NULL THEN 'Yes' ELSE 'No' END 
          </native>
        </fld>
       </display>
       <where>
         <and>
            <le>
              <fld name="EnrStartDt" type="datetime" />
              <val>[Date]</val>
            </le>
            <ge>
              <fld name="EnrEndDt" type="datetime" />
              <val>[Date]</val>
            </ge>
             <eq>
               <fld name="EmpDep.Emp" type="String"/>
               <val>[fld_PendBen.Emp]</val>
             </eq>
             <eq>
               <fld name="EmpDep.Beneficiary" type="YesNo"/>
               <val type="YesNo" >Yes</val>
             </eq>
             <eq>
               <fld name="Ben.BenAllow" type="YesNo"/>
               <val type="YesNo" >Yes</val>
             </eq>
             <notnull><fld name="EmpBenElgBnfId" /></notnull>
          </and>
        </where>
      <order>
        <fld name="EmpBenElg.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
      </order>
      <synchronize dataset="PendBen">
        <if>
          <when>
            <and>
              <eq>
                <val>[fld_PendBen.Emp]</val>
                <val>[fld_PendBenBnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.EnrSum]</val>
                <val>[fld_PendBenBnf.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.PlnOrd]</val>
                <val>[fld_PendBenBnf.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.PlnTyp]</val>
                <val>[fld_PendBenBnf.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.Ben]</val>
                <val>[fld_PendBenBnf.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Keep</then>
          <when>
            <and>
              <eq>
                <val>[fld_PendBen.Emp]</val>
                <val>[fld_PendBenBnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_PendBen.EnrSum]</val>
                <val>[fld_PendBenBnf.EnrSum]</val>
              </eq>
              <or>
                <ne>
                  <val>[fld_PendBen.PlnOrd]</val>
                  <val>[fld_PendBenBnf.PlnOrd]</val>
                </ne>
                <ne>
                  <val>[fld_PendBen.PlnTyp]</val>
                  <val>[fld_PendBenBnf.PlnTyp]</val>
                </ne>
                <ne>
                  <val>[fld_PendBen.Ben]</val>
                  <val>[fld_PendBenBnf.Ben]</val>
                </ne>
              </or>
            </and>
          </when>
          <then>Stop</then>
          <else>Skip</else>
        </if>
      </synchronize>
      <includehistory>Yes</includehistory>
    </dataset>

    
    <dataset name="CfgValue">
      <tables>
        <tbl name="Cfg" />
      </tables>
      <display>
        <fld name="Cfg.*" />
      </display>
      <where>
        <eq>
          <fld name="Cfg" />
          <val>[var_Cfg]</val>
        </eq>
      </where>
    </dataset>


    <dataset name="GetEmlCur">
      <tables>
        <tbl name="Emp" />
        <tbl name="Eml" join="LEFT" to="Emp">
          <and>
            <eq>
              <fld name="Emp.Emp" />
              <fld name="Eml.Emp" />
            </eq>
            <eq>
              <fld name="Eml.IsPrm" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="Eml.SalRatCur" />
      </display>
      <pfind>[F_NavPfind]</pfind>
      <order>
        <fld name="Eml.Eml"/>
      </order>
    </dataset>
  
  
    <view name="list">
      <script name="EmpHeaderCtls" />
      
      <script name="EmlHeaderCtls" />
      <display>
        <title>Review Open Enrollment Benefits Dependents / Beneficiaries Details</title>
        <instructions>Choose Dependents / Beneficiaries</instructions>
        <head />
        <toolbar />
        <body>
          
          <set var="[var_Cfg]">DedDateDsp</set>
          <set var="[var_DedDateDsp]">No</set>
          <datasetopen dataset="CfgValue" />
          <datasetnext dataset="CfgValue" />
          <set var="[var_DedDateDsp]">[fld_CfgValue.ConfigValues]</set>
          <datasetclose dataset="CfgValue" />

          <set var="[var_Cfg]">PayEffectiveDt</set>
          <set var="[var_PayEffectiveDt]"></set>
          <datasetopen dataset="CfgValue" />
          <datasetnext dataset="CfgValue" />
          <set var="[var_PayEffectiveDt]">[fld_CfgValue.ConfigValues]</set>
          <datasetclose dataset="CfgValue" />
          

          <set var="[TotPayrollDeduction]">0</set>
          <set var="[TotPremium]">0</set>
          <set var="[TotFlexCredits]">0</set>
          <set var="[TotAnnElectAmt]">0</set>
          <set var="[TotDepAnnElectAmt]">0</set>
          <set var="[TotUnits]">0</set>
          
          <set var="[SalRatCur]"><lookup dataset="GetEmlCur" /></set>
          <datasheet dataset="main" headers="TOP" showlinecount="No">
            <groups>
              <groupby val="[fld_EmpCde]">
                <header>
                  <row>
                    <col>[ctl_EmpName]</col>
                    <col>[ctl_ProfilePopup]</col>
                  </row>
                </header>
              </groupby>
              <groupby val="[fld_EnrSum]">
                <if>
                  <when>
                    <and>
                      <ne>
                        <val>[fld_EnrSum]</val>
                        <val />
                      </ne>
                      <ne>
                        <val>[fld_PlnTyp]</val>
                        <val />
                      </ne>
                    </and>
                  </when>
                  <then>
                    <header>
                      <row>
                        <col>[ctl_EnrSum]</col>
                      </row>
                    </header>
                  </then>
                </if>
              </groupby>
              
              <script name="BenFrmEmlHdrGrp" />
              <groupby val="[fld_PlnTyp]">
                <if>
                  <when>
                    <ne>
                      <val>[fld_PlnTyp]</val>
                      <val />
                    </ne>
                  </when>
                  <then>
                    <header>
                      <row>
                        <col>[ctl_PlnTypName]</col>
                      </row>
                      <if when="[fld_PlnTypDesc]">
                        <row>
                          <col>[ctl_PlnTypDesc]</col>
                        </row>
                      </if>
                    </header>
                  </then>
                </if>
              </groupby>
            </groups>
            <if>
              <when>
                <ne>
                  <val>[fld_PlnTyp]</val>
                  <val />
                </ne>
              </when>
              <then>
                <row>
                  <set var="[ExtraColumns]">8</set>
                  <set var="[TotPremium]">
                    <plus>
                      <val>[TotPremium]</val>
                      <convertcur>
                        <orig>[fld_main.EmpPrem]</orig>
                        <from>[fld_main.EmpPremCur]</from>
                        <to>[SalRatCur]</to>
                        <exchangedt>[fld_main.BenStartDt]</exchangedt>
                      </convertcur>
                    </plus>
                  </set>
                  <col>[ctl_BenName]</col>
                  <col>[ctl_BenEffectiveDt]</col>
                  
                  <if>
                    <when>
                      <eq>
                        <val>[var_DedDateDsp]</val>
                        <val>Yes</val>
                      </eq>
                    </when>
                    <then>
                      <col>[ctl_EmpBenDedStartDt]</col>
                      <col>[ctl_EmpBenDedEndDt]</col>
                    </then>
                  </if>

                  <if>
                    <when>
                      <eq>
                        <val>[var_PayEffectiveDt]</val>
                        <val>Cort</val>
                      </eq>
                    </when>
                    <then>
                      <col>[ctl_EmpBenPayEffectiveDt]</col>
                    </then>
                  </if>
                  

                  <col>[ctl_InsCar]</col>
                  <if>
                    <when>
                      <gt>
                        <val>[fld_main.CmpCov]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col align="LEFT">[ctl_CmpCov]</col>
                    </then>
                  </if>
                  <if>
                    <when>
                      <gt>
                        <val>[fld_main.EmpCov]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col align="LEFT">[ctl_EmpCov]</col>
                    </then>
                  </if>
                  <if>
                    <when>
                      <gt>
                        <val>[fld_main.CmpPrem]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col align="LEFT">[ctl_CmpPrem]</col>
                    </then>
                  </if>
                  <col align="LEFT">[ctl_EmpPrem]</col>
                  
                  <set var="[TotPayrollDeduction]">
                    <plus>
                      <val>[TotPayrollDeduction]</val>
                      <convertcur>
                        <orig>[fld_main.PayrollDeduction]</orig>
                        <from>[fld_main.PayrollDeductionCur]</from>
                        <to>[SalRatCur]</to>
                        <exchangedt>[fld_main.BenStartDt]</exchangedt>
                      </convertcur>
                    </plus>
                  </set>
                  <col>[ctl_PayrollDeduction]</col>
                  <if>
                    <when>
                      <gt>
                        <val>[fld_main.FlexCredits]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      
                      
                      <col align="LEFT">[ctl_FlexCredits]</col>
                    </then>
                  </if>
                  <if when="[fld_main.FSAAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <set var="[TotAnnElectAmt]">
                      <plus>
                        <val>[TotAnnElectAmt]</val>
                        <convertcur>
                          <orig>[fld_main.AnnElectAmt]</orig>
                          <from>[fld_main.AnnElectAmtCur]</from>
                          <to>[SalRatCur]</to>
                          <exchangedt>[fld_main.BenStartDt]</exchangedt>
                        </convertcur>
                      </plus>
                    </set>
                    <col>[ctl_AnnElectAmt]</col>
                  </if>
                  <if when="[fld_main.FSADepAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <set var="[TotDepAnnElectAmt]">
                      <plus>
                        <val>[TotDepAnnElectAmt]</val>
                        <convertcur>
                          <orig>[fld_main.DepAnnElectAmt]</orig>
                          <from>[fld_main.DepAnnElectAmtCur]</from>
                          <to>[SalRatCur]</to>
                          <exchangedt>[fld_main.BenStartDt]</exchangedt>
                        </convertcur>
                      </plus>
                    </set>
                    <col>[ctl_DepAnnElectAmt]</col>
                  </if>
                  <if when="[fld_main.UntAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    
                    
                    <col align="LEFT">[ctl_Units]</col>
                  </if>
                  <if when="[fld_main.PCPAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <col>[ctl_Physician]</col>
                  </if>
                  <if>
                    <when>
                      <gt>
                        <val>[ExtraColumns]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <col span="[ExtraColumns]" />
                    </then>
                  </if>
                </row>
                <if when="[fld_main.DepAllow]">
                  <row>
                    <col span="11">
                      <datasheet dataset="Dep" headers="TOP" showlinecount="No">
                        <row>
                          <col>[ctl_DepName]</col>
                          <if when="[fld_main.PCPAllow]">
                             <col>[ctl_DepPhysician]</col>
                          </if>
                        </row>
                      </datasheet>
                    </col>
                  </row>
                </if>
                <if when="[fld_main.BenAllow]">
                  <row>
                    <col span="11">
                      <datasheet dataset="Bnf" headers="TOP" showlinecount="No">
                        <if>
                          <when>
                            <eq>
                              <val>[fld_Contingency]</val>
                              <val>Yes</val>
                            </eq>
                          </when>
                          <then>
                            <set var="[IsContingent]">Contingent</set>
                          </then>
                          <else>
                            <set var="[IsContingent]">Primary</set>
                          </else>
                        </if>
                        <row>
                          <col>[ctl_BnfName]</col>
                          <col>[ctl_Contingency]</col>
                          <col>[ctl_BnfPct]</col>
                        </row>
                      </datasheet>
                    </col>
                  </row>
                </if>
                <set var="[NoSelection]">No</set>
              </then>
            </if>
          </datasheet>
          <v>
            <hr />
          </v>
          <v style="groupbylabel">Totals:</v>
          <datasheet dataset="main" headers="TOP" next="No" Title="Totals">
            <groups>
              <groupby val="[fld_Emp]">
                <header>
                  <row>
                    <col align="RIGHT">[ctl_TotPayrollDeduction]</col>
                  </row>
                  <row>
                    <col align="RIGHT">[ctl_TotPremium]</col>
                  </row>
                  <row>
                    <col align="RIGHT">[ctl_TotAnnElectAmt]</col>
                  </row>
                  <row>
                    <col align="RIGHT">[ctl_TotDepAnnElectAmt]</col>
                  </row>
                </header>
              </groupby>
            </groups>
          </datasheet>
          <v>
            <hr />
          </v>
          <set var="[TotPayrollDeduction]">0</set>
          <set var="[TotPremium]">0</set>
          <set var="[TotFlexCredits]">0</set>
          <set var="[TotAnnElectAmt]">0</set>
          <set var="[TotDepAnnElectAmt]">0</set>
          <set var="[TotUnits]">0</set>
          <datasheet dataset="PendBen" headers="TOP" showlinecount="No" title="Pending Benefits">
            <groups>
              <groupby val="[fld_EnrSum]">
                <if>
                  <when>
                    <ne>
                      <val>[fld_EnrSum]</val>
                      <val/>
                    </ne>
                  </when>
                  <then>
                    <header>
                      <row>
                        <col>[ctl_EnrSum]</col>
                      </row>
                    </header>
                  </then>
                </if>
              </groupby>
              <groupby val="[fld_PlnTyp]">
                <if>
                  <when>
                    <ne>
                      <val>[fld_PlnTyp]</val>
                      <val/>
                    </ne>
                  </when>
                  <then>
                    <header>
                      <row>
                        <col>[ctl_PlnTypName]</col>
                      </row>
                      <if when="[fld_PlnTypDesc]">
                        <row>
                          <col>[ctl_PlnTypDesc]</col>
                        </row>
                      </if>
                    </header>
                  </then>
                </if>
              </groupby>
            </groups>
            <if>
              <when>
                <ne>
                  <val>[fld_PlnTyp]</val>
                  <val/>
                </ne>
              </when>
              <then>
                <row>
                  <set var="[ExtraColumns]">9</set>
                  <set var="[TotPremium]">
                    <plus>
                      <val>[TotPremium]</val>
                      <convertcur>
                        <orig>[fld_PendBen.EmpPrem]</orig>
                        <from>[fld_PendBen.EmpPremCur]</from>
                        <to>[SalRatCur]</to>
                        <exchangedt>[fld_PendBen.BenStartDt]</exchangedt>
                      </convertcur>
                    </plus>
                  </set>
                  <col>[ctl_BenName]</col>
                  <col>[ctl_InsCar]</col>
                  <col>[ctl_EmpBenElgDedStartDt]</col>
                  <col>[ctl_EmpBenElgDedEndDt]</col>
                  <if>
                    <when>
                      <and>
                        <not>
                          <startswith>
                            <val>[fld_PendBen.Ben]</val>
                            <val>HCFSA</val>
                          </startswith>
                        </not>
                        <not>
                          <startswith>
                            <val>[fld_PendBen.Ben]</val>
                            <val>DCFSA</val>
                          </startswith>
                        </not>
                      </and>
                    </when>
                    <then>
                      <if>
                        <when>
                          <and>
                            <ne>
                              <val>[fld_PendBen.PlnTyp]</val>
                              <val>Medical</val>
                            </ne>
                            <ne>
                              <val>[fld_PendBen.PlnTyp]</val>
                              <val>Dental</val>
                            </ne>
                          </and>
                        </when>
                        <then>
                          <if>
                            <when>
                              <gt>
                                <val>[fld_PendBen.CmpCov]</val>
                                <val>0</val>
                              </gt>
                            </when>
                            <then>
                              <set var="[ExtraColumns]">
                                <minus>
                                  <val>[ExtraColumns]</val>
                                  <val>1</val>
                                </minus>
                              </set>
                              <col align="RIGHT">[ctl_CmpCov]</col>
                            </then>
                          </if>
                          <if>
                            <when>
                              <gt>
                                <val>[fld_PendBen.EmpCov]</val>
                                <val>0</val>
                              </gt>
                            </when>
                            <then>
                              <set var="[ExtraColumns]">
                                <minus>
                                  <val>[ExtraColumns]</val>
                                  <val>1</val>
                                </minus>
                              </set>
                              <col align="RIGHT">[ctl_EmpCov]</col>
                            </then>
                          </if>
                        </then>
                      </if>
                      <if>
                        <when>
                          <gt>
                            <val>[fld_PendBen.CmpPrem]</val>
                            <val>0</val>
                          </gt>
                        </when>
                        <then>
                          <set var="[ExtraColumns]">
                            <minus>
                              <val>[ExtraColumns]</val>
                              <val>1</val>
                            </minus>
                          </set>
                          <col align="RIGHT">[ctl_CmpPrem]</col>
                        </then>
                      </if>
                      <col align="RIGHT">[ctl_EmpPrem]</col>
                      <if>
                        <when>
                          <gt>
                            <val>[fld_PendBen.FlexCredits]</val>
                            <val>0</val>
                          </gt>
                        </when>
                        <then>
                          <set var="[ExtraColumns]">
                            <minus>
                              <val>[ExtraColumns]</val>
                              <val>1</val>
                            </minus>
                          </set>
                      
                          
                          <col align="RIGHT">[ctl_FlexCredits]</col>
                        </then>
                      </if>
                    </then>
                  </if>
                  <if when="[fld_PendBen.FSAAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <set var="[TotAnnElectAmt]">
                      <plus>
                        <val>[TotAnnElectAmt]</val>
                        <convertcur>
                          <orig>[fld_PendBen.AnnElectAmt]</orig>
                          <from>[fld_PendBen.AnnElectAmtCur]</from>
                          <to>[SalRatCur]</to>
                          <exchangedt>[fld_PendBen.BenStartDt]</exchangedt>
                        </convertcur>
                      </plus>
                    </set>
                    <col>[ctl_AnnElectAmt]</col>
                  </if>
                  <if when="[fld_PendBen.FSADepAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <set var="[TotAnnElectAmt]">
                      <plus>
                        <val>[TotAnnElectAmt]</val>
                        <convertcur>
                          <orig>[fld_PendBen.DepAnnElectAmt]</orig>
                          <from>[fld_PendBen.DepAnnElectAmtCur]</from>
                          <to>[SalRatCur]</to>
                          <exchangedt>[fld_PendBen.BenStartDt]</exchangedt>
                        </convertcur>
                      </plus>
                    </set>
                    <col>[ctl_DepAnnElectAmt]</col>
                  </if>
                  <if>
                    <when>
                      <and>
                        <not>
                          <startswith>
                            <val>[fld_PendBen.Ben]</val>
                            <val>HCFSA</val>
                          </startswith>
                        </not>
                        <not>
                          <startswith>
                            <val>[fld_PendBen.Ben]</val>
                            <val>DCFSA</val>
                          </startswith>
                        </not>
                      </and>
                    </when>
                    <then>
                      <if when="[fld_PendBen.UntAllow]">
                        <set var="[ExtraColumns]">
                          <minus>
                            <val>[ExtraColumns]</val>
                            <val>1</val>
                          </minus>
                        </set>
                      
                        
                        <col align="RIGHT">[ctl_Units]</col>
                      </if>
                      <if when="[fld_PendBen.PCPAllow]">
                        <set var="[ExtraColumns]">
                          <minus>
                            <val>[ExtraColumns]</val>
                            <val>1</val>
                          </minus>
                        </set>
                        <col>[ctl_Physician]</col>
                      </if>
                    </then>
                  </if>
                  <if when="[fld_PendBen.PayrollDeduction]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <set var="[TotPayrollDeduction]">
                      <plus>
                        <val>[TotPayrollDeduction]</val>
                        <convertcur>
                          <orig>[fld_PendBen.PayrollDeduction]</orig>
                          <from>[fld_PendBen.PayrollDeductionCur]</from>
                          <to>[SalRatCur]</to>
                          <exchangedt>[fld_PendBen.BenStartDt]</exchangedt>
                        </convertcur>
                      </plus>
                    </set>
                    <col align="RIGHT">[ctl_PayrollDeduction]</col>
                  </if>
                  <if>
                    <when>
                      <gt>
                        <val>[ExtraColumns]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <col span="[ExtraColumns]"/>
                    </then>
                  </if>
                </row>
                <if when="[fld_PendBen.DepAllow]">
                  <row>
                    <col span="12">
                      <datasheet dataset="PendBenDep" headers="TOP" showlinecount="No">
                        <row>
                          <col>[ctl_DepName]</col>
                          <col>[ctl_DepPhysician]</col>
                        </row>
                      </datasheet>
                    </col>
                  </row>
                </if>
                <if when="[fld_PendBen.BenAllow]">
                  <row>
                    <col span="12">
                      <datasheet dataset="PendBenBnf" headers="TOP" showlinecount="No">
                        <if>
                          <when>
                            <eq>
                              <val>[fld_Contingency]</val>
                              <val>Yes</val>
                            </eq>
                          </when>
                          <then>
                            <set var="[IsContingent]">Contingent</set>
                          </then>
                          <else>
                            <set var="[IsContingent]">Primary</set>
                          </else>
                        </if>
                        <row>
                          <col>[ctl_BnfName]</col>
                          <col>[ctl_Contingency]</col>
                          <col>[ctl_BnfPct]</col>
                        </row>
                      </datasheet>
                    </col>
                  </row>
                </if>
                <set var="[NoSelection]">No</set>
              </then>
            </if>
          </datasheet>
          <v>
            <hr/>
          </v>
          <v style="groupbylabel">Totals:</v>
          <datasheet dataset="PendBen" headers="TOP" next="No" Title="Totals">
            <groups>
              <groupby val="[fld_Emp]">
                <header>
                  <row>
                    <col align="RIGHT">[ctl_TotPayrollDeduction]</col>
                  </row>
                  <row>
                    <col align="RIGHT">[ctl_TotPremium]</col>
                  </row>
                  <row>
                    <col align="RIGHT">[ctl_TotAnnElectAmt]</col>
                  </row>
                  <row>
                    <col align="RIGHT">[ctl_TotDepAnnElectAmt]</col>
                  </row>
                </header>
              </groupby>
            </groups>
          </datasheet>
          <if when="[NoSelection]">
            <v>Employee has not chosen any Benefits</v>
          </if>
        </body>
      </display>
    </view>
