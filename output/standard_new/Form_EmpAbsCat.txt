<event name="global" where="Client">
  <native lang="Javascript">
    <![CDATA[
      if (!NuCtlDatagrid.Datagrid_main_1) {
        NuCtlDatagrid.Datagrid_main_1 = {};
      }
   /**   NuCtlDatagrid.Datagrid_main_1.FormConfig = {
        "sSortOrder" : "EmpAbsCatEffDt_Absence Start Date",
        "sGridGroupBy" : "EmpAbsCatEffDt_Absence Start Date",
        "sSortDirection" : "ASC"
      };*/
    ]]>
  </native>
</event>
<event name="onChange" ctl="HisDsp" where="Client">
  <native lang="JavaScript">
    <![CDATA[
    var v_sVal;
    var v_dt;
    var v_dtStart;
    var v_dtEnd;
    var v_id;
    var v_today = new Date();
    var v_parent;
    v_sVal = ctlGetVal("N_HisDsp_none_1");
    if (v_sVal == '') {
      ctlSetVal("N_HisDsp_none_1", "Show History");
      v_sVal = "Show History";
    }
    if (v_sVal == "Show Only Current") {
    $('span[SQROPEN]fld="EmpAbsCatEffDt"[SQRCLOSE]').each(function(index, element){
      v_dt = NuStr.toDate($(element).text(), NuView.User.FormatDate);
      v_dtStart = NuDate.getNativeDateTime(v_dt);
      v_id = $(element).attr('id');
      v_id = v_id.substring(v_id.lastIndexOf('_') + 1);
      v_dt = NuStr.toDate($('#C_EmpAbsCatEfdDt_main_' + v_id).text(), NuView.User.FormatDate);
      v_dtEnd = NuDate.getNativeDateTime(v_dt);
      if ((v_today < v_dtStart) || (v_today > v_dtEnd)) {
      v_parent = $(element).parents('tbody[SQROPEN]nutype="GroupHeader"[SQRCLOSE]').hide();
      v_parent.nextUntil('tbody[SQROPEN]nutype="GroupHeader"[SQRCLOSE]', 'tbody').hide();
    }
    });
    } else {
     $('tbody').show();
    }
    v_Return = false;
    ]]>
  </native>
</event>
<event name="onChange" ctl="unitOpt" where="Client">
  <native lang="JavaScript">
    <![CDATA[
     var v_rowNum;
     var v_sName;
     var v_bShowHour;
     var v_bShowDays;
     var v_options = ctlGetVal("N_unitOpt_none_1");
      if (v_options == '') {
       v_options = 'Both';
       ctlSetVal("N_unitOpt_none_1", "Both");
     }
     switch (v_options) {
     case 'Both':
       v_bShowHour = true;
        v_bShowDays = true;
       break;
     case 'As Hours':
       v_bShowHour = true;
        v_bShowDays = false;
       break;
     case 'As Days':
       v_bShowHour = false;
        v_bShowDays = true;
       break;
     }
     
  if (v_bShowHour) {
     v_sName = ctlGetProp("C_Lbl3_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_Lbl5_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_Lbl7_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_Lbl9_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjHoursAccrued_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjHoursCarriedOver_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjHoursRemaining_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjHoursTaken_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     $('span[SQROPEN]fld="HoursAccrued"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="HoursCarriedOver"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="HoursRemaining"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="HoursTaken"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjHoursAccrued"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjHoursCarriedOver"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjHoursRemaining"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjHoursTaken"[SQRCLOSE]').parent().show();
  } else {
      v_sName = ctlGetProp("C_Lbl3_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_Lbl5_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_Lbl7_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_Lbl9_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_PrjHoursAccrued_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_PrjHoursCarriedOver_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_PrjHoursRemaining_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      v_sName = ctlGetProp("C_PrjHoursTaken_main_1", 'lbl');
      $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
      $('span[SQROPEN]fld="HoursAccrued"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="HoursCarriedOver"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="HoursRemaining"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="HoursTaken"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="PrjHoursAccrued"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="PrjHoursCarriedOver"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="PrjHoursRemaining"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="PrjHoursTaken"[SQRCLOSE]').parent().hide();
  }
       if (v_bShowDays) {
     v_sName = ctlGetProp("C_Lbl2_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_Lbl4_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_Lbl6_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_Lbl8_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjDaysAccrued_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjDaysCarriedOver_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjDaysRemaining_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     v_sName = ctlGetProp("C_PrjDaysTaken_main_1", 'lbl');
     $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').show();
     $('span[SQROPEN]fld="DaysAccrued"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="DaysCarriedOver"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="DaysRemaining"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="DaysTaken"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjDaysAccrued"[SQRCLOSE]').parent().show();
      $('span[SQROPEN]fld="PrjDaysCarriedOver"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjDaysRemaining"[SQRCLOSE]').parent().show();
     $('span[SQROPEN]fld="PrjDaysTaken"[SQRCLOSE]').parent().show();
  } else {
       v_sName = ctlGetProp("C_Lbl2_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_Lbl4_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_Lbl6_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_Lbl8_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_PrjDaysAccrued_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_PrjDaysCarriedOver_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_PrjDaysRemaining_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       v_sName = ctlGetProp("C_PrjDaysTaken_main_1", 'lbl');
       $('td[SQROPEN]class="datasheetTopLabel"[SQRCLOSE][SQROPEN]title="' + v_sName + '"[SQRCLOSE]').hide();
       $('span[SQROPEN]fld="DaysAccrued"[SQRCLOSE]').parent().hide();
       $('span[SQROPEN]fld="DaysCarriedOver"[SQRCLOSE]').parent().hide();
       $('span[SQROPEN]fld="DaysRemaining"[SQRCLOSE]').parent().hide();
       $('span[SQROPEN]fld="DaysTaken"[SQRCLOSE]').parent().hide();
       $('span[SQROPEN]fld="PrjDaysAccrued"[SQRCLOSE]').parent().hide();
       $('span[SQROPEN]fld="PrjDaysCarriedOver"[SQRCLOSE]').parent().hide();
       $('span[SQROPEN]fld="PrjDaysRemaining"[SQRCLOSE]').parent().hide();
      $('span[SQROPEN]fld="PrjDaysTaken"[SQRCLOSE]').parent().hide();
  }
  v_Return = false;

    ]]>
  </native>
</event>
<!-- Server-side Events 
<event name="beforeFunction" where="Server">
  <foreach dataset="PrcAcc">
      <if>
        <when><ne><val>[fld_IsDbEngine]</val><val>Yes</val></ne></when>
        <then></then>
        <else></else>
      </if>
  </foreach>
  <ifnoerror>
    <return>
      <obj>  
        oTcl.set(Tcl)
        oTcl.calBalance([F_Value1])
      </obj>
    </return>
  </ifnoerror>
</event>-->
<event name="onClick" ctl="PrcAbsCat" where="Server">
  <foreach dataset="PrcAcc">
    <if>
      <when>
        <ne>
          <val>[fld_IsDbEngine]</val>
          <val>Yes</val>
        </ne>
      </when>
      <then>
        <set var="[useJava]">Yes</set>
        <set var="[localEml]">[fld_PrcAcc.Eml]</set>
      </then>
      <else>
        <set var="[EXECSql]">
            EXEC ZZAccrualTask '[N_Emp_main_1]', '[fld_PrcAcc.Tcl]','Update' , null, '[fld_PrcAcc.Eml]', '[fld_PrcAcc.EmpTclStartDateSQL]' , '[fld_PrcAcc.EmpTclEndDateSQL]'
        </set>
        <dataset name="ProcessAccrual" type="SQLSelect">
          <sql>
              [EXECSql]
            </sql>
        </dataset>
        <datasetopen dataset="ProcessAccrual" />
        <datasetclose dataset="ProcessAccrual" />
      </else>
    </if>
  </foreach>
  <if>
    <when>
      <eq>
        <val>[useJava]</val>
        <val>Yes</val>
      </eq>
    </when>
    <then>
      <timeaccrual action="regularaccrual">
        <emp>[N_Emp_main_1]</emp>
        <eml>[localEml]</eml>
        <absencecat>[N_AbsCat_Main_1]</absencecat>
        <id>[F_NavId]</id>
        <runasdate>[N_asOfDate]</runasdate>
      </timeaccrual>
    </then>
  </if>
</event>
<event name="onLoad" where="Server">
  <if>
    <when>
      <or>
        <eq>
          <val>[F_Application]</val>
          <val>HR</val>
        </eq>
        <and>
          <eq>
            <val>[F_Application]</val>
            <val>ESS</val>
          </eq>
          <eq>
            <val>[F_Flow]</val>
            <val>Wizards</val>
          </eq>
        </and>
      </or>
    </when>
    <then>
      <set var="[var_Readonly]">No</set>
    </then>
    <else>
      <set var="[var_Readonly]">Yes</set>
    </else>
  </if>
  <set var="[v_sWhereClause]">
    <lookup dataset="IncludeHistoryStatus" />
  </set>
</event>
<!-- Datasets -->
<dataset name="ComboUnitOpt">
  <cols>1</cols>
  <r>
    <c>Both</c>
  </r>
  <r>
    <c>As Hours</c>
  </r>
  <r>
    <c>As Days</c>
  </r>
</dataset>
<dataset name="ComboHisDsp">
  <cols>1</cols>
  <r>
    <c>Show History</c>
  </r>
  <r>
    <c>Show Only Current</c>
  </r>
</dataset>
<dataset name="PrcAcc">
  <tables>
    <tbl name="EmpTclCat" main="Yes" />
    <tbl name="Tcl" join="LEFT" to="EmpTclCat">
      <eq>
        <fld name="Tcl.Tcl" />
        <fld name="EmpTclCat.Tcl" />
      </eq>
    </tbl>
    <tbl name="EmpAbsCat" join="LEFT" to="Tcl">
      <eq>
        <fld name="Tcl.AbsCat" />
        <fld name="EmpAbsCat.AbsCat" />
      </eq>
    </tbl>
  </tables>
  <display>
    <fld name="Tcl" origname="EmpTclCat.Tcl" />
    <fld name="EmpAbsCatEffDt" origname="EmpAbsCat.EmpAbsCatEffDt" />
    <fld name="EmpTclStartDate">
      <native lang="SQLServer">
       dbo.NuDateToStr(EmpTclStartDate, 'SQL', 'DateOnly')
      </native>
    </fld>
    <fld name="EmpTclStartDateRaw">
      <native lang="SQLServer">
       dbo.NuDateToStr(EmpTclStartDate, 'NuXML', 'DateOnly')
      </native>
    </fld>
    <fld name="EmpTclEndDateSQL">
      <native lang="SQLServer">
       dbo.NuDateToStr(EmpTclEndDate, 'SQL', 'DateOnly')
      </native>
    </fld>
    <fld name="EmpTclEndDateRaw">
      <native lang="SQLServer">
        dbo.NuDateToStr(EmpTclEndDate, 'NuXML', 'DateOnly')
      </native>
    </fld>
    <fld name="EmpTclCat.Eml" />
    <fld name="OrderByDate" origname="EmpTclcat.EmpTclStartDate" type="DateTime" />
    <fld name="Tcl.IsDbEngine" />
    <fld name="EmpAbsCat.AbsCat" />
  </display>
  <where>
    <and>
      <eq>
        <fld name="Tcl.AbsCat" />
        <val>[N_AbsCat_main_1]</val>
      </eq>
<!--PY:99257-Added extra condition for employees not to get confirmation messages for the
past years based on Absence Category selection -->
      <ge>
        <fld name="EmpTclCat.EmpTclStartDate" />
        <val type="DateTime">[N_EmpAbsCatEffDt_main_1]</val>
      </ge>
      <eq>
        <fld name="EmpTclCat.Emp" />
        <val>[N_Emp_main_1]</val>
      </eq>
      <eq>
        <fld name="EmpAbsCat.Emp" />
        <val>[N_Emp_main_1]</val>
      </eq>
      <isnull>
        <fld name="EmpTclCat.EmpTclCatEfdDt" />
      </isnull>
      <isnull>
        <fld name="Tcl.TclEfdDt" />
      </isnull>
      <notnull>
        <fld name="EmpTclCat.EmpTclStartDate" />
      </notnull>
      <notnull>
        <fld name="EmpTclCat.EmpTclEndDate" />
      </notnull>
    </and>
  </where>
  <order>
    <fld name="OrderByDate" descending="No" />
  </order>
  <distinct>Yes</distinct>
  <includehistory>Yes</includehistory>
</dataset>
<dataset name="ComboAbsCat">
  <tables>
    <tbl name="AbsCat" />
  </tables>
  <display>
    <fld name="AbsCat" />
  </display>
  <order>
    <fld name="AbsCat" />
  </order>
</dataset>
<dataset name="main">
  <tables>
    <tbl name="Emp" />
    <tbl name="EmpAbsCat" main="Yes" join="LEFT" to="Emp">
      <eq>
        <fld name="Emp.Emp" />
        <fld name="EmpAbsCat.Emp" />
      </eq>
    </tbl>
	 <tbl name="AbsCat" join="LEFT" to="EmpAbsCat">
      <eq>
        <fld name="AbsCat.AbsCat" />
        <fld name="EmpAbsCat.AbsCat" />
      </eq>
    </tbl>
  </tables>
  <display>
    <fld name="EmpAbsCat.*" />
    <fld name="Emp.Emp" />
    <fld name="Emp.ActMilitary" />
    <fld name="EmpNo">
      <append>
        <fld name="Emp.Emp" type="String" />
      </append>
    </fld>
    <fld name="StrHireDt">
      <native lang="SqlServer">cast(Emp.HireDt AS nVarChar)</native>
    </fld>
    <fld name="FMLAElig">
      <native lang="SQLServer">
        case
          when datediff(d,Emp.HireDt,getdate())/CASE WHEN year(getDate())%4 = 0 THEN 366 ELSE 365 END &gt;= 1 then 'Yes'
          else 'No'
        end
      </native>
    </fld>
    <fld name="SrvYrs">
      <native lang="SQLServer">datediff(mm,HireDt,getdate())/12</native>
    </fld>
    <fld name="AbsCat.DisableProcess" />
    <script name="EmpHeaderFlds" />
  </display>
  <order>
    <fld name="EmpAbsCatEffDt" descending="Yes" />
    <fld name="EmpAbsCat.AbsCat" />
  </order>
  <where>[v_sWhereClause]</where>
  <includehistory>Yes</includehistory>
</dataset>
<dataset name="IncludeHistoryStatus">
  <tables>
    <tbl name="Cfg" />
  </tables>
  <display>
    <fld name="IncludeHistory">
      <native lang="SQLServer">
        <![CDATA[
          case
            when ConfigValues like '%[F_Application]%' then '[LT]ge[GT][LT]fld name="EmpAbsCatEfdDt" /[GT][LT]val[GT][Date][LT]/val[GT][LT]/ge[GT]'
            else '[LT]eq[GT][LT]val[GT]1[LT]/val[GT][LT]val[GT]1[LT]/val[GT][LT]/eq[GT]'
          end
        ]]>
      </native>
    </fld>
  </display>
  <where>
    <eq>
      <fld name="Cfg" />
      <val>EmpAbsCat.Dsp</val>
    </eq>
  </where>
</dataset>
<dataset name="Fmla">
  <tables>
    <tbl name="Emp" />
    <tbl name="EmpTim" join="LEFT" to="Emp">
      <and>
        <eq>
          <fld name="Emp.Emp" />
          <fld name="EmpTim.Emp" />
        </eq>
        <in>
          <fld name="TimAct" />
          <dataset name="SelTimAct">
            <tables>
              <tbl name="TimAct" />
            </tables>
            <display>
              <fld name="TimAct" />
            </display>
            <where>
              <in>
                <fld name="AbsCat" />
                <dataset name="SelAbsCat">
                  <tables>
                    <tbl name="AbsCat" />
                  </tables>
                  <display>
                    <fld name="AbsCat" />
                  </display>
                  <where>
                    <and>
                      <eq>
                        <fld name="FMLA" />
                        <val>1</val>
                      </eq>
                      <ne>
                        <fld name="AbsCat" />
                        <val>MilitaryFMLA</val>
                      </ne>
                    </and>
                  </where>
                </dataset>
              </in>
            </where>
          </dataset>
        </in>
        <ge>
          <fld name="EmpTimEffDt" />
          <fld name="mydatetime">
            <native lang="SQLServer">getdate()-365</native>
          </fld>
        </ge>
        <le>
          <fld name="EmpTimEffDt" />
          <val>[Date]</val>
        </le>
      </and>
    </tbl>
  </tables>
  <display>
    <fld name="Emp.Emp" />
    <fld name="FMLAAbsCat">
      <native lang="SQLServer">'SPFCA'</native>
    </fld>
    <fld name="EmpAbsCatEffDt" type="DateTime">
      <native lang="SQLServer">
        SELECT getDate() - CASE WHEN year(getDate())%4 = 0 THEN 366 ELSE 365 END
      </native>
    </fld>
    <fld name="EmpAbsCatEfdDt" type="DateTime">
      <native lang="SQLServer">getdate()</native>
    </fld>
    <fld name="DaysAccrued" type="Number">
      <native lang="SQLServer">60</native>
    </fld>
    <fld name="HoursAccrued" type="Number">
      <native lang="SQLServer">
        60 * (Select (Case When Sum(Eml.WrkHrs) = 0 Then 40 Else IsNull(sum(Eml.WrkHrs),40) End/5) from Eml where EmlEfdDt is null and Eml.Emp = Emp.Emp)
      </native>
    </fld>
    <fld name="DaysTaken" type="Number">
      <native lang="SQLServer">IsNull(Sum(Hours/8), 0)</native>
    </fld>
    <fld name="HoursTaken" type="Number">
      <native lang="SQLServer">IsNull(Sum(Hours), 0)</native>
    </fld>
    <fld name="DaysRemaining" type="Number">
      <native lang="SQLServer">(60-IsNull(Sum(Hours/8), 0))</native>
    </fld>
    <fld name="HoursRemaining" type="Number">
      <native lang="SQLServer">
        (60 * (Select (Case When Sum(WrkHrs) = 0 Then 40 Else IsNull(sum(WrkHrs),40) End/5) from Eml where Eml.EmlEfdDt is null and Eml.Emp = Emp.Emp))-IsNull(Sum(Hours), 0)
      </native>
    </fld>
  </display>
  <where>
    <eq>
      <fld name="Emp.Emp" />
      <val>[var_Emp]</val>
    </eq>
  </where>
  <group>
    <fld name="Emp.Emp" />
  </group>
  <includehistory>Yes</includehistory>
</dataset>
<dataset name="ActiveMilitaryFmla">
  <tables>
    <tbl name="Emp" />
    <tbl name="EmpTim" join="LFFT" to="Emp">
      <and>
        <eq>
          <fld name="Emp.Emp" />
          <fld name="EmpTim.Emp" />
        </eq>
        <in>
          <fld name="TimAct" />
          <dataset name="SelTimAct">
            <tables>
              <tbl name="TimAct" />
            </tables>
            <display>
              <fld name="TimAct" />
            </display>
            <where>
              <in>
                <fld name="AbsCat" />
                <dataset name="SelAbsCat">
                  <tables>
                    <tbl name="AbsCat" />
                  </tables>
                  <display>
                    <fld name="AbsCat" />
                  </display>
                  <where>
                    <and>
                      <eq>
                        <fld name="FMLA" />
                        <val>1</val>
                      </eq>
                      <eq>
                        <fld name="AbsCat" />
                        <val>MilitaryFMLA</val>
                      </eq>
                    </and>
                  </where>
                </dataset>
              </in>
            </where>
          </dataset>
        </in>
        <ge>
          <fld name="EmpTimEffDt" />
          <fld name="mydatetime">
            <native lang="SQLServer">getdate()-(SELECT CASE WHEN year(getDate())%4 = 0 THEN 366 ELSE 365 END)</native>
          </fld>
        </ge>
        <le>
          <fld name="EmpTimEffDt" />
          <val>[Date]</val>
        </le>
      </and>
    </tbl>
  </tables>
  <display>
    <fld name="Emp.Emp" />
    <fld name="FMLAAbsCat">
      <native lang="SQLServer">'Active Military FMLA'</native>
    </fld>
    <fld name="EmpAbsCatEffDt" type="DateTime">
      <native lang="SQLServer">
        (getDate() - (SELECT CASE WHEN year(getDate())%4 = 0 THEN 366 ELSE 365 END))
      </native>
    </fld>
    <fld name="EmpAbsCatEfdDt" type="DateTime">
      <native lang="SQLServer">getdate()</native>
    </fld>
    <fld name="DaysAccrued" type="Number">
      <native lang="SQLServer">70</native>
    </fld>
    <fld name="HoursAccrued" type="Number">
      <native lang="SQLServer">
        70 * (Select (Case When Sum(Eml.WrkHrs) = 0 Then 40 Else IsNull(sum(Eml.WrkHrs),40) End/5) from Eml where EmlEfdDt is null and Eml.Emp = Emp.Emp)
      </native>
    </fld>
    <fld name="DaysTaken" type="Number">
      <native lang="SQLServer">IsNull(Sum(Hours/8), 0)</native>
    </fld>
    <fld name="HoursTaken" type="Number">
      <native lang="SQLServer">IsNull(Sum(Hours), 0)</native>
    </fld>
    <fld name="DaysRemaining" type="Number">
      <native lang="SQLServer">(70-IsNull(Sum(Hours/8), 0))</native>
    </fld>
    <fld name="HoursRemaining" type="Number">
      <native lang="SQLServer">
        (70 * (Select (Case When Sum(WrkHrs) = 0 Then 40 Else IsNull(sum(WrkHrs),40) End/5) from Eml where Eml.EmlEfdDt is null and Eml.Emp = Emp.Emp))-IsNull(Sum(Hours), 0)
      </native>
    </fld>
  </display>
  <where>
    <and>
      <eq>
        <fld name="Emp.Emp" />
        <val>[var_Emp]</val>
      </eq>
      <eq>
        <fld name="Emp.ActMilitary" />
        <val>1</val>
      </eq>
    </and>
  </where>
  <group>
    <fld name="Emp.Emp" />
  </group>
  <includehistory>Yes</includehistory>
</dataset>
<view name="list">
  <script name="EmpHeaderCtls" />
  <display>
    <title>Employee Absences</title>
    <instructions>Enter Employee Absences Information</instructions>
    <head />
    <if>
      <when>
        <eq>
          <val>[var_Readonly]</val>
          <val>No</val>
        </eq>
      </when>
      <then>
        <toolbar>
          <add />
        </toolbar>
      </then>
      <else>
        <toolbar />
      </else>
    </if>
    <set var="[var_Emp]">[fld_main.Emp]</set>
    <set var="[var_HireDt]">[fld_main.StrHireDt]</set>
    <set var="[var_FMLAElig]">[fld_main.FMLAElig]</set>
    <set var="[var_ActiveMilitary]">[fld_main.ActMilitary]</set>
    <body>
      <datasheet dataset="main" showlinecount="No" headers="OVER" next="No">
        <script name="EmpHeaderGrp" />
      </datasheet>
      <row>
        <datasheet dataset="none" showlinecount="No" headers="LEFT" next="No">
          <row>
            <col>[ctl_unitOpt]</col>
            <col>[ctl_HisDsp]</col>
          </row>
        </datasheet>
      </row>
      <row>
        <col>
          <tabset>
            <tab name="Absence Tracking" selected="Yes">
              <datasheet dataset="main" headers="TOP" showlinecount="Yes" width="1400">
                <groups>
                  <groupby val="[fld_EmpAbsCatEffDt]">
                    <header>
                      <row>
                        <col>[ctl_EmpAbsCatEffdt]</col>
                        <col>[ctl_EmpAbsCatEfddt]</col>
                      </row>
                    </header>
                  </groupby>
                </groups>
                <row>
                  <if>
                    <when>
                      <eq>
                        <val>[F_Mode]</val>
                        <val>readonly</val>
                      </eq>
                    </when>
                    <then>
                      <col>[ctl_AbsCatLbl]</col>
                    </then>
                    <else>
                      <col>[ctl_AbsCat][ctl_eml]</col>
                    </else>
                  </if>
                  <if>
                    <when>
                      <ne>
                        <val>[fld_main.DisableProcess]</val>
                        <val>Yes</val>
                      </ne>
                    </when>
                    <then>
                      <col>[ctl_Lbl2]</col>
                    </then>
                    <else>
                      <col />
                    </else>
                  </if>
                  <col>[ctl_Lbl3]</col>
				  <if>
					<when>
						<ne>
						<val>[fld_main.DisableProcess]</val>
						<val>Yes</val>
						</ne>
					</when>
					<then>
						<col>[ctl_Lbl4]</col>
					</then>
					<else>
						<col></col>
					</else>
				  </if>
                  <col>[ctl_Lbl5]</col>
				  <if>
					<when>
						<ne>
						<val>[fld_main.DisableProcess]</val>
						<val>Yes</val>
						</ne>
					</when>
					<then>
						<col>[ctl_Lbl6]</col>
					</then>
					<else>
						<col></col>
					</else>
				  </if>
                  <col>[ctl_Lbl7]</col>
				   <if>
					<when>
						<ne>
						<val>[fld_main.DisableProcess]</val>
						<val>Yes</val>
						</ne>
					</when>
					<then>
						<col>[ctl_Lbl8]</col>
					</then>
					<else>
						<col></col>
					</else>
				  </if>
                  <col>[ctl_Lbl9]</col>
                  <if>
                    <when>
                      <ne>
                        <val>[fld_main.DisableProcess]</val>
                        <val>Yes</val>
                      </ne>
                    </when>
                    <then>
                      <if>
                        <when>
                          <ne>
                            <val>[F_Mode]</val>
                            <val>readonly</val>
                          </ne>
                        </when>
                        <then>
                          <col>[ctl_LogDetails]</col>
                        </then>
                      </if>
                      <col>[ctl_CarryOverExpDate]</col>
                      <col>[ctl_CarryOverTimeUsed]</col>
                      <col>[ctl_CarryOverTimeExp]</col>
                      <col>[ctl_PrjDaysAccrued] </col>
                      <col>[ctl_PrjHoursAccrued] </col>
                      <col>[ctl_PrjDaysCarriedOver] </col>
                      <col>[ctl_PrjHoursCarriedOver] </col>
                      <col>[ctl_PrjDaysTaken] </col>
                      <col>[ctl_PrjHoursTaken] </col>
                      <col>[ctl_PrjDaysRemaining] </col>
                      <col>[ctl_PrjHoursRemaining] </col>
                      <if>
                        <when>
                          <ne>
                            <val>[F_Mode]</val>
                            <val>readonly</val>
                          </ne>
                        </when>
                        <then>
                          <col>[ctl_prjLogDetails]</col>
                        </then>
                      </if>
                    </then>
                  </if>
                </row>
              </datasheet>
            </tab>
            <tab name="FMLA Tracking">
              <security>
                <application name="HR" />
              </security>
              <if>
                <when>
                  <eq>
                    <val>[var_FMLAElig]</val>
                    <val>No</val>
                  </eq>
                </when>
                <then>
                  <v>Employee has not been employed for 1 year (Hire Date = [var_HireDt]) and is not eligible for FMLA</v>
                </then>
                <else>
                  <datasheet dataset="Fmla" headers="TOP" showlinecount="No">
                    <row>
                      <col>[ctl_FMLAAbsCat]</col>
                      <col>[ctl_FMLAEffDt]</col>
                      <col>[ctl_FMLAEfdDt]</col>
                      <col>[ctl_FMLADaysAccrued]</col>
                      <col>[ctl_FMLAHoursAccrued]</col>
                      <col>[ctl_FMLADaysTaken]</col>
                      <col>[ctl_FMLAHoursTaken]</col>
                      <col>[ctl_FMLADaysRemaining]</col>
                      <col>[ctl_FMLAHoursRemaining]</col>
                    </row>
                    <if>
                      <when>
                        <eq>
                          <val>[var_ActiveMilitary]</val>
                          <val>Yes</val>
                        </eq>
                      </when>
                      <then>
                        <foreach dataset="ActiveMilitaryFmla">
                          <row>
                            <col>[ctl_FMLAAbsCat1]</col>
                            <col>[ctl_FMLAEffDt]</col>
                            <col>[ctl_FMLAEfdDt]</col>
                            <col>[ctl_FMLADaysAccrued1]</col>
                            <col>[ctl_FMLAHoursAccrued1]</col>
                            <col>[ctl_FMLADaysTaken1]</col>
                            <col>[ctl_FMLAHoursTaken1]</col>
                            <col>[ctl_FMLADaysRemaining1]</col>
                            <col>[ctl_FMLAHoursRemaining1]</col>
                          </row>
                        </foreach>
                      </then>
                    </if>
                  </datasheet>
                </else>
              </if>
            </tab>
          </tabset>
        </col>
      </row>
    </body>
  </display>
</view>
<view name="edit">
  <script name="EmpHeaderCtls" />
  <display>
    <title>Employee Absences</title>
    <instructions>Enter Employee Absences Information</instructions>
    <head />
    <if>
      <when>
        <eq>
          <val>[var_Readonly]</val>
          <val>No</val>
        </eq>
      </when>
      <then>
        <toolbar>
          <find />
          <add />
          <save />
          <delete />
        </toolbar>
      </then>
      <else>
        <toolbar />
      </else>
    </if>
    <set var="[var_Emp]">[fld_main.Emp]</set>
    <set var="[var_HireDt]">[fld_main.StrHireDt]</set>
    <set var="[var_FMLAElig]">[fld_main.FMLAElig]</set>
    <body>
      <datasheet dataset="main" headers="LEFT">
        <groups>
          <groupby val="[fld_EmpId]">
            <header>
              <row>
                <col wrap="No">[ctl_FullName][ctl_Emp][ctl_ProfilePopup]</col>
                <if>
                  <when>
                    <and>
                      <eq>
                        <val>[var_Readonly]</val>
                        <val>No</val>
                      </eq>
                      <ne>
                        <val>[fld_DisableProcess]</val>
                        <val>Yes</val>
                      </ne>
                    </and>
                  </when>
                  <then>
                    <col>[ctl_PrcAbsCat]</col>
                  </then>
                </if>
              </row>
            </header>
          </groupby>
        </groups>
        <row>
          <col span="2">[ctl_AbsCat][ctl_PrcMsgCur][ctl_PrcMsgPrj]</col>
        </row>
        <row>
          <col span="2">[ctl_EmpAbsCatEffDt]</col>
        </row>
        <row>
          <col span="2">[ctl_EmpAbsCatEfdDt]</col>
        </row>
<!--<row>
     <col span="2">[ctl_asOfDate]</col>
        </row>-->
        <if><when> <ne>
	      <val>[fld_main.DisableProcess]</val>
	      <val>Yes</val>
	    </ne></when><then>
        <row>
          <col>
            <v>Actual Days</v>
          </col>      
          <col>
            <v>Projected Days</v>
          </col> 
        </row>
        <row>      
       	  <col align="RIGHT">[ctl_DaysCarriedOver]</col>			
          <col align="RIGHT">[ctl_PrjDaysCarriedOver]</col>
        </row>
        <row>          
	  <col align="RIGHT">[ctl_DaysAccrued]</col>
	  <col align="RIGHT">[ctl_PrjDaysAccrued]</col>
        </row>
        <row>          
      	  <col align="RIGHT">[ctl_DaysTaken]</col>			
          <col align="RIGHT">[ctl_PrjDaysTaken]</col>
        </row>
        <row>
          <col align="RIGHT">[ctl_DaysRemaining]</col>
	  <col align="RIGHT">[ctl_PrjDaysRemaining]</col>     
        </row>
        </then>
        </if>
        <row>
          <col>
            <v>Actual Hours</v>
          </col>
		  <if><when> <ne>
                      <val>[fld_main.DisableProcess]</val>
                      <val>Yes</val>
                    </ne></when><then>
          <col>
            <v>Projected Hours</v>
          </col>
		   </then>
                </if>
        </row>
        <row>
          <col align="RIGHT">[ctl_HoursCarriedOver]</col>
		   <if><when> <ne>
                      <val>[fld_main.DisableProcess]</val>
                      <val>Yes</val>
                    </ne></when><then>
          <col align="RIGHT">[ctl_PrjHoursCarriedOver]</col>
		  </then>
                </if>
        </row>
        <row>
          <col align="RIGHT">[ctl_HoursAccrued]</col>
		   <if><when> <ne>
                      <val>[fld_main.DisableProcess]</val>
                      <val>Yes</val>
                    </ne></when><then>
          <col align="RIGHT">[ctl_PrjHoursAccrued]</col>
		  </then>
                </if>
        </row>
        <row>
          <col align="RIGHT">[ctl_HoursTaken]</col>
		   <if><when> <ne>
                      <val>[fld_main.DisableProcess]</val>
                      <val>Yes</val>
                    </ne></when><then>
          <col align="RIGHT">[ctl_PrjHoursTaken]</col>
		  </then>
                </if>
        </row>
        <row>
          <col align="RIGHT">[ctl_HoursRemaining]</col>
		   <if><when> <ne>
                      <val>[fld_main.DisableProcess]</val>
                      <val>Yes</val>
                    </ne></when><then>
          <col align="RIGHT">[ctl_PrjHoursRemaining]</col>
		  </then>
                </if>
        </row>
        <row>
          <col align="RIGHT">[ctl_CarryOverExpDate]</col>
        </row>
        <row>
          <col align="RIGHT">[ctl_CarryOverTimeUsed]</col>
        </row>
        <row>
          <col align="RIGHT">[ctl_CarryOverTimeExp]</col>
        </row>
      </datasheet>
    </body>
  </display>
</view>
