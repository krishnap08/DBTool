<script name="PersonalCombo" /> 
<event name="onLoad" where="server">          
  <if>
    <when>
      <or>  
        <eq><val>[F_Application]</val><val>HR</val></eq>
        <and>
          <eq><val>[F_Application]</val><val>ESS</val></eq>
          <eq><val>[F_Flow]</val><val>Wizards</val></eq>
        </and>
        <ne>
        	<val>[F_TicketId]</val>
        	<val/>
        </ne>
      </or> 
    </when>
    <then><set var="[var_Readonly]">No</set></then>
    <else><set var="[var_Readonly]">Yes</set></else>
  </if>
</event>
<!--
  # DEFECT#1264-LG-NV:
  # Event Modified
  # View Check Added In Event Declaration
-->
<event name="onLoad" where="Client" view="edit">
  <native lang="JavaScript">
    <![CDATA[
    //Code Commented Out
    /*if (ctlGetVal("F_View") == "edit") {
      lookup("EmpAdr","prm",prm_sCtl,"N_Emp_main_1="+ctlGetVal("N_Emp_main_1"));
    }
    v_Return = false;*/
      //DEFECT#1264-LG-NV: Code Added
      //Execute "lookup" Function To Fetch Data
      lookup("EmpAdr", "prm", "N_Dummy", "N_Emp_main_1="+ctlGetVal("N_Emp_main_1"));
    ]]>
  </native>
</event>
<!-- DEFECT#1264-LG-NV: onLookup Event Added -->
<event name="onLookup" ctl="Dummy" where="Client" view="edit">
  <native lang="JavaScript">
    <![CDATA[
      //Variable Declaration
      var v_sEmpAdrId;

      //Variable Initialization
      v_sEmpAdrId = lookupGetVal("Existence");

      //If Query Does Not Return Any EmpAdrId, Set "PrmAdrs" Value To Yes
      if (v_sEmpAdrId == "") {
        ctlSetVal("N_PrmAdrs_main_1","Yes");
      }
    ]]>
  </native>
</event>

<!--
Commented out 2010-04-05 EHG
<event name="onLookup" where="Client">
  <native lang="JavaScript">
    <![CDATA[
      /* 27382-EG-NV */
      var v_sCity;
      var v_sStateProv;
      if (prm_sCtl == "N_ZipPostal_main_1") {
        v_sCity = lookupGetVal("City");
        v_sStateProv = lookupGetVal("StateProv");
        ctlSetVal("N_City_main_1", v_sCity);
        ctlSetVal("N_StateProv_main_1", v_sStateProv);
      }
      sEmpAdrId = lookupGetVal("EmpAdrId");
      if (sEmpAdrId == "" && ctlGetVal("F_View") == "edit") {
        ctlSetVal("N_PrmAdrs_main_1","Yes");
      }
      v_Return = false;
    ]]>
  </native>
</event>

<event name="onChange" ctl="ZipPostal" where="Client" view="edit">
  <native lang="Javascript">
  <![CDATA[
    lookup("EmpAdr", "ComboZipPostal", "N_ZipPostal_main_1", "N_ZipPostal_main_1=" + ctlGetVal("N_ZipPostal_main_1"));
  ]]>
  </native>
</event>
-->
<event name="onLookup" where="Client">
  <native lang="JavaScript">
    <![CDATA[     
      sEmpAdrId = lookupGetVal("Existence");
      if (sEmpAdrId == "" && ctlGetVal("F_View") == "edit") {
        ctlSetVal("N_PrmAdrs_main_1","Yes");
      }
      v_Return = false;
    ]]>
  </native>
</event>

<!--
<event name="AfterSave" where="Server">
  <if>
    <when>
      <and>
        <eq><val>[N_PrmAdrs_main_1]</val><val>Yes</val></eq>
        <eq><val>[F_View]</val><val>edit</val></eq>
      </and>  
    </when>   
    <then>
      <foreach dataset="main">    
        <if> 
          <when><ne><val>[N_AdrTyp]</val><val>[fld_main.AdrTyp]</val></ne></when>    
          <then>
            <update dataset="AdrUpdate">
              <data>
                <row>
                  <fld name="EmpAdrId">[fld_main.EmpAdrId]</fld>
                  <fld name="PrmAdrs">No</fld>
                 </row> 
              </data> 
            </update>
          </then>
        </if>  
      </foreach>  
    </then>
  </if>  
</event>
-->
<!-- Dataset for Event 27382-EG-NV -->
<dataset name="ComboZipPostal">
  <tables>
    <tbl name="ZipPostal" />
  </tables>
  <display>
    <fld name="City" />
    <fld name="StateProv" />
  </display>
  <where>
    <eq>
      <fld name="ZipPostal" />
      <val>[N_ZipPostal_main_1]</val>
    </eq>
  </where>
</dataset>
<!-- Dataset End for Event 27382-EG-NV -->
<dataset name="AdrUpdate" type="SQLSelect">
  <tables>
    <tbl name="EmpAdr" main="Yes"/>
  </tables>
  <display> 
    <fld name="EmpAdrId" key="Yes"/>
    <fld name="PrmAdrs" />
   </display>
   <where>
     <and>
      <eq>
        <fld name="PrmAdrs" type="YesNo" />
        <val>Yes</val>
      </eq>
<!--      
      <eq>
        <fld name="Emp" type="String" />
        <val>[fld_main.Emp]</val>
      </eq> 
-->      
      <ne>
        <fld name="AdrTyp" />
        <val>[F_AdrTyp]</val>
      </ne>
    </and>
  </where>
  <order>
    <fld name="EmpAdr.Emp" />
  </order> 
</dataset>
<dataset name="prm">
  <tables>
    <tbl name="EmpAdr" main="Yes" />
  </tables>
  <display>
    <fld name="Existence" origname="EmpAdr.EmpAdrId" />
  </display>
  <find>
   <findwhere>
    <and>
      <eq>
        <fld name="EmpAdr.Emp" type="String" />
        <val>[N_Emp]</val>
      </eq>
      <eq>
        <fld name="EmpAdr.PrmAdrs" type="YesNo" />
        <val>Yes</val>
      </eq>      
    </and>
   </findwhere>   
  </find>  
</dataset>
<dataset name="main" showlinecount="no">
  <tables>
    <tbl name="Emp" />
    <tbl name="EmpAdr" main="Yes" join="LEFT" to="Emp"><eq><fld name="Emp.Emp" /><fld name="EmpAdr.Emp" /></eq></tbl>
  </tables>
  <display>
    <fld name="EmpAdr.*" />
    <script name="EmpHeaderFlds" />
  </display>
  <order>
    <fld name="PrmAdrs" descending="Yes" />
    <fld name="AdrTyp" />
    <fld name="EmpAdrEffDt" descending="Yes" />
  </order>
  <includehistory>Yes</includehistory>
</dataset>
<view name="list">
  <script name="EmpHeaderCtls" />
  <display>
    <title>Employee Address Information</title>
<if><when><ne><val>[F_Flow]</val><val>Wizards</val></ne></when>
      <then><instructions> Below is your list of Addresses.  To change an address
                 please use the Address Change Wizard. </instructions></then>
       <else><instructions>You  may enter as many addresses as necessary.  Please indicate the
               type of address and whether or not it is your primary address.  The primary
               address is the address the company will use for all communication.  To add additional addresses
               click the "ADD" icon in the tool bar at the top of the page.  Be sure to complete
               the wizard to save your changes.</instructions></else>
</if>
    <head></head>
    <if><when><eq><val>[var_Readonly]</val><val>No</val></eq></when><then>    
    <toolbar><add /><save /></toolbar></then><else>
    <toolbar></toolbar></else></if>
    <body>
  <datasheet dataset="none" headers="LEFT" next="No">
	<groupby val="[fld_Emp]">
      <header>
            <row>
              <col span="1">[ctl_EmpDsp]</col> <col span="1">[ctl_FullName]</col> <col span="1">[ctl_ProfilePopup]</col> <col span="1">[ctl_RegulatorFlag]</col>
            </row>
      </header>
    </groupby>
   </datasheet>
      <datasheet dataset="main" headers="TOP">
       <groupby val="[fld_EmpId]">
       </groupby>
        <row>
          <col>[ctl_Lnk1]</col>
          <col>[ctl_Address]</col>
          <col>[ctl_City]</col>
          <col>[ctl_StateProv]</col>
          <col>[ctl_ZipPostal]</col>
          <col>[ctl_PrmAdrs]</col>
          <col>[ctl_AdrTyp]</col>
          <col>[ctl_Emp]</col>
        </row>
      </datasheet>
    </body>
  </display>
</view>
<view name="edit">
  <script name="EmpHeaderCtls" />
  <display>
    <title>Employee Address Information</title>
    <instructions></instructions>
    <head></head>
<if><when><eq><val>[var_Readonly]</val><val>No</val></eq></when><then>    
    <toolbar><find /><add /><save /><delete /></toolbar></then><else>
    <toolbar></toolbar></else>
</if>
    <body>

      <datasheet dataset="main" headers="LEFT">
        <script name="EmpHeaderGrp" />
        <set var="[EmpCde]">[fld_EmpCde]</set>
    <row>
      <col>
        <tabset>
          <tab name="General" selected="Yes">
            <datasheet dataset="main" headers="LEFT" next="No">      
              <row><col span="2">[ctl_AdrTyp]</col></row>
              <row><col span="2">[ctl_PrmAdrs]</col></row>
              <!-- Defect# 1289 INT_NN: Reordering of Address controls starts -->
              <row><col span="2">[ctl_Cty]</col><col span="2">[ctl_LocalCty]</col></row>
              <row><col span="2">[ctl_StateProv]</col><col span="2">[ctl_LocalStateProv]</col></row>
              <row><col span="2">[ctl_HouseNo]</col></row>
              <row><col span="2">[ctl_Address]</col><col span="2">[ctl_LocalAddress]</col></row>
              <row><col span="2">[ctl_Address2]</col><col span="2">[ctl_LocalAddress2]</col></row>
              <row><col span="2">[ctl_Address3]</col><col span="2">[ctl_LocalAddress3]</col></row>
              <row><col span="2">[ctl_City]</col><col span="2">[ctl_LocalCity]</col></row>
              <row><col span="2">[ctl_ZipPostal]</col></row>
              <!-- Defect# 1289 INT_NN: Reordering of Address controls ends -->
              <row><col span="2">[ctl_Region]</col></row>
              <row><col span="2">[ctl_PhoneHome]</col></row>
              <row><col span="2">[ctl_EmailHome]</col></row>
            </datasheet>
          </tab>
          <tab name="User Defined Fields">
            <datasheet dataset="main" headers="LEFT" next="No">
              <row>
              <col>[ctl_UDField1]</col>
              </row>
              <row>
              <col>[ctl_UDField2]</col>
              </row>
              <row>
              <col>[ctl_UDField3]</col>
              </row>
              <row>
              <col>[ctl_UDField4]</col>
              </row>
              <row>
              <col>[ctl_UDField5]</col>
              </row>
              <row>
              <col>[ctl_UDField6]</col>
              </row>
              <row>
              <col>[ctl_UDField7]</col>
              </row>
              <row>
              <col>[ctl_UDField8]</col>
              </row>
              <row>
              <col>[ctl_UDField9]</col>
              </row>
              <row>
              <col>[ctl_UDField10]</col>
              </row>               
            </datasheet>
          </tab>
        </tabset>
      </col>
    </row>
      </datasheet>
    </body>
  </display>
</view>
