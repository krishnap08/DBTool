<!-- Form EmpBenElgDepRvw Starts -->
  <!-- Script Inclusion Block Starts -->
    <script name="BenCombo" />
    <script name="EmpDepCombo" />
  <!-- Script Inclusion Block Ends -->
  <!-- Event Handling Block Starts -->
    <!-- Client Side Event Handling Block Starts -->
      <event name="global" where="Client">
        <native lang="Javascript">
          <![CDATA[
            function checkBnfPct() {
              var v_iCnt = 0;
              var v_i = 0;
              var rCtl = "";
              var rCtlVal = "";
              var fPTot = 0.00;
              var fCTot = 0.00;
              var fBPct = 0.00;
              var iCCnt = 0;
              var iPCnt = 0;
              var sBen = "";
              var sPrevBen = "";
              var sMg = ""; 
              var v_Return = false;
              var v_isDone = false;

              v_iCnt = ctlGetVal("F_RowCnt_Bnf");
              if (v_iCnt > 0) {
                sPrevBen = ctlGetVal("N_Ben_Bnf_1");
                v_i = 1;
                while(!v_isDone) {
                  if (v_i <= v_iCnt) {
                    sBen = ctlGetVal("N_Ben_Bnf_" + v_i);
                  } else {
                    v_isDone = true;
                  }
                  if (sBen != sPrevBen) {
                    if ((iPCnt > 0) && (fPTot != 100)) {
                      sMg = "Total Primary Percent != 100%";
                    } else if (iCCnt > 0 && iPCnt <= 0) {
                      sMg = "Contingency Beneficiaries cannot be selected without Primary Beneficiaries";
                    } else if ((iCCnt > 0) && (fCTot != 100)) {
                      sMg ="Total Contingency Percent != 100%";
                    }
                    if (sMg != "") {
                      v_isDone = true;
                    } else {
                      fPTot = 0.0;
                      fCTot = 0.0;
                      iCCnt = 0;
                      iPCnt = 0;
                    }
                  }
                  if (!v_isDone) {
                    rCtlVal = ctlGetVal("N_SysBnfSelect_Bnf_"+ v_i);
                    if (rCtlVal=="Yes") {
                      rCtlVal = ctlGetVal("N_Contingency_Bnf_"+v_i);
                      fBPct = parseFloat(ctlGetVal("N_BnfPct_Bnf_"+v_i));
                      if (rCtlVal == "Yes") {
                        fCTot = parseFloat(fCTot)+parseFloat(fBPct);
                        iCCnt = iCCnt + 1; 
                      } else {
                        fPTot = parseFloat(fPTot )+parseFloat(fBPct);
                        iPCnt = iPCnt + 1;
                      }
                    }
                    v_i += 1;
                    sPrevBen = sBen;
                    sBen = "";
                  }
                }//while
                if (sMg != "") {
                  msg("Beneficiary Percentage Error","msgtext="+sMg,"N_BnfPct_Bnf_" + v_i);
                  v_Return = false;
                } else {
                  v_Return = true;
                }
              } else {
                v_Return = true;
            }//outer if() 
    
              return v_Return;
        }//function end
          ]]>
        </native>
      </event>

      <event name="BeforeNext" where="Client">
        <native lang="Javascript">
          <![CDATA[
            v_Return = checkBnfPct();
          ]]>
        </native>
      </event>

      <event name="BeforePrev" where="Client">
        <native lang="Javascript">
          <![CDATA[
            v_Return = checkBnfPct();
          ]]>
        </native>
      </event>

      <event name="BeforeSave" where="Client">
        <native lang="Javascript">
          <![CDATA[
            v_Return = checkBnfPct();
          ]]>
        </native>
      </event>

      <event name="onLoad" where="Client">
        <native lang="Javascript">
          <![CDATA[
            var v_iCnt;
            v_iCnt = ctlGetVal("F_RowCnt_main");
            var obj_N_AnnElectAmt;
            var obj_O_AnnElectAmt;
            for (v_i = 1; v_i <= v_iCnt; v_i++) {
              obj_N_AnnElectAmt = ctlGetDef("N_AnnElectAmt_main_" + v_i);
              obj_O_AnnElectAmt = ctlGetDef("O_AnnElectAmt_main_" + v_i);
              
              if (obj_N_AnnElectAmt && (obj_N_AnnElectAmt.value == "0.00" || obj_N_AnnElectAmt.value == "")) {
                if (!obj_O_AnnElectAmt || obj_O_AnnElectAmt.value == "") {
                  obj_N_AnnElectAmt.value = "0.00";
                } else {
                  obj_N_AnnElectAmt.value = "";
                }
              }
            }
          ]]>
        </native>
      </event>      
    <!-- Client Side Event Handling Block Ends -->
    <!-- Server Side Event Handling Block Starts -->
      <event name="AfterSave" where="Server">
        <foreach dataset="Dep" type="controls">
          <if>
            <when>
              <and>
                <eq>
                  <val>[N_SysDepSelect_Dep_[controlrow]]</val>
                  <val>Yes</val>
                </eq>
                <eq>
                  <val>[O_SysDepSelect_Dep_[controlrow]]</val>
                  <val>No</val>
                </eq>
              </and>
            </when>
            <then>
              <update dataset="DepUpdate">
                <data>
                  <row>
                    <fld name="Emp">[N_Emp_Dep_[controlrow]]</fld>
                    <fld name="Eml">[N_Eml_Dep_[controlrow]]</fld>
                    <fld name="Ben">[N_Ben_Dep_[controlrow]]</fld>
                    <fld name="Dep">[N_Dep_Dep_[controlrow]]</fld>
                    <fld name="EmpBenElgDepEffDt">[DateTime]</fld>
                    <fld name="DepPhysician">[N_DepPhysician_Dep_[controlrow]]</fld>
                    <fld name="DepBenEligibleDt">[N_EligibleDt_Dep_[controlrow]]</fld>
                  </row>
                </data>
              </update>
            </then>
            <when>
              <and>
                <eq>
                  <val>[N_SysDepSelect_Dep_[controlrow]]</val>
                  <val>No</val>
                </eq>
                <eq>
                  <val>[O_SysDepSelect_Dep_[controlrow]]</val>
                  <val>Yes</val>
                </eq>
              </and>
            </when>
            <then>
              <delete dataset="DepUpdate">
                <data>
                  <row>
                    <fld name="EmpBenElgDepId">[N_SysElgDepId_Dep_[controlrow]]</fld>
                  </row>
                </data>
              </delete>
            </then>
            <when>
              <and>
                <eq>
                  <val>[N_SysDepSelect_Dep_[controlrow]]</val>
                  <val>Yes</val>
                </eq>
                <gt>
                  <val>[N_SysElgDepId_Dep_[controlrow]]</val>
                  <val>0</val>
                </gt>
              </and>
            </when>
            <then>
              <update dataset="DepUpdate">
                <data>
                  <row>
                    <fld name="EmpBenElgDepId">[N_SysElgDepId_Dep_[controlrow]]</fld>
                    <fld name="EmpBenElgDepEffDt">[N_EmpBenElgEffDt_Dep_[controlrow]]</fld>
                    <fld name="DepPhysician">[N_DepPhysician_Dep_[controlrow]]</fld>
                    <fld name="DepBenEligibleDt">[N_EligibleDt_Dep_[controlrow]]</fld>
                  </row>
                </data>
              </update>
            </then>
          </if>
        </foreach>
        <foreach dataset="Bnf" type="controls">
          <if>
            <when>
              <and>
                <eq>
                  <val>[N_SysBnfSelect_Bnf_[controlrow]]</val>
                  <val>Yes</val>
                </eq>
                <eq>
                  <val>[O_SysBnfSelect_Bnf_[controlrow]]</val>
                  <val>No</val>
                </eq>
              </and>
            </when>
            <then>
              <update dataset="BnfUpdate">
                <data>
                  <row>
                    <fld name="Emp">[N_Emp_Bnf_[controlrow]]</fld>
                    <fld name="Eml">[N_Eml_Bnf_[controlrow]]</fld>
                    <fld name="Ben">[N_Ben_Bnf_[controlrow]]</fld>
                    <fld name="BnfNum">[N_BnfNum_Bnf_[controlrow]]</fld>
                    <fld name="EmpBenElgBnfEffDt">[DateTime]</fld>
                    <fld name="BnfPct">[N_BnfPct_Bnf_[controlrow]]</fld>
                    <fld name="Contingency">[N_Contingency_Bnf_[controlrow]]</fld>
                  </row>
                </data>
              </update>
            </then>
            <when>
              <and>
                <eq>
                  <val>[N_SysBnfSelect_Bnf_[controlrow]]</val>
                  <val>No</val>
                </eq>
                <eq>
                  <val>[O_SysBnfSelect_Bnf_[controlrow]]</val>
                  <val>Yes</val>
                </eq>
              </and>
            </when>
            <then>
              <delete dataset="BnfUpdate">
                <data>
                  <row>
                    <fld name="EmpBenElgBnfId">[N_SysElgBnfId_Bnf_[controlrow]]</fld>
                  </row>
                </data>
              </delete>
            </then>
            <when>
              <and>
                <eq>
                  <val>[N_SysBnfSelect_Bnf_[controlrow]]</val>
                  <val>Yes</val>
                </eq>
                <gt>
                  <val>[N_SysElgBnfId_Bnf_[controlrow]]</val>
                  <val>0</val>
                </gt>
              </and>
            </when>
            <then>
              <update dataset="BnfUpdate">
                <data>
                  <row>
                    <fld name="EmpBenElgBnfId">[N_SysElgBnfId_Bnf_[controlrow]]</fld>
                    <fld name="EmpBenElgBnfEffDt">[N_EmpBenElgEffDt_Bnf_[controlrow]]</fld>
                    <fld name="BnfPct">[N_BnfPct_Bnf_[controlrow]]</fld>
                    <fld name="Contingency">[N_Contingency_Bnf_[controlrow]]</fld>
                  </row>
                </data>
              </update>
            </then>
          </if>
        </foreach>
      </event>

      <event name="onLoad" where="Server">
        <if xml="Run">
          <when>
            <eq>
              <val>[P_enroll]</val>
              <val>current</val>
            </eq>
          </when>
          <then>
            <set var="[JoinClause]">
              <and xml="keep">
                <eq>
                  <fld name="EmpEnrSum.EnrSum" />
                  <fld name="EnrSum.EnrSum" />
                </eq>
                <le>
                  <fld name="EnrStartDt" type="datetime" />
                  <val>[DateTime]</val>
                </le>
                <ge>
                  <fld name="EnrEndDt" type="datetime" />
                  <val>[DateTime]</val>
                </ge>
              </and>
            </set>
            <set var="[InnerClause]">INNER JOIN EnrSum ON EnrSum.EnrSum=EmpEnrSum.EnrSum AND EnrStartDt [LT]= getDate() AND EnrEndDt [GT]= getDate()</set>
          </then>
          <else>
            <set var="[JoinClause]">
              <and xml="keep">
                <le>
                  <fld name="OEStartDt" type="datetime" />
                  <val>[DateTime]</val>
                </le>
                <ge>
                  <fld name="OEEndDt" type="datetime" />
                  <val>[DateTime]</val>
                </ge>
              </and>
            </set>
            <set var="[InnerClause]">INNER JOIN EnrSum ON EnrSum.EnrSum=EmpEnrSum.EnrSum AND OEStartDt [LT]= getDate() AND OEEndDt [GT]= getDate()</set>
          </else>
        </if>
        <set var="[NavID]">
          <stringpart>               
             <orig>[F_NavPfind]</orig>               
             <after>&lt;val&gt;</after>               
             <before>&lt;/val&gt;</before>           
          </stringpart>
        </set>
        <if xml="Run">
        <when>
         <eq>
            <val>[F_Application]</val>
            <val>ESS</val>
         </eq>
        </when>
        <then>
            <set var="[EmpVal]">[S_SecEmp]</set>   
        </then>
        <else>
           <datasetopen dataset="EmpDS" />   
           <datasetnext dataset="EmpDS" />   
              <set var="[EmpVal]">[fld_EmpDS.Emp]</set>   
           <datasetclose dataset="EmpDS" />
        </else>
        </if>
      </event>
    <!-- Server Side Event Handling Block Ends -->
  <!-- Event Handling Block Ends -->
  <!-- Dataset Definition Block Ends -->
    <!--
      # 47409-LM-NV: Main Dataset Modified To Handle Multiple Eml
      # Eml table added into the dataset to group the records by Eml
      # Condition EmpEnrSum.Emp = Eml.Eml added for multiple Eml
      # Join with PayGrp and Job table added to display in the header
      # Field added to sort the records by Eml.Eml
    -->
    <dataset name="main">
      <tables>
        <tbl name="Emp" />
        <!-- 47409-LM-NV: Join with Eml table added to goup the records by Eml -->
        <tbl name="Eml" join="LEFT" to="Emp">
          <and>
            <eq>
              <fld name="Emp.Emp"/>
              <fld name="Eml.Emp"/>
            </eq>
            <isnull>
              <fld name="Eml.EmlEfdDt" />
            </isnull>
          </and>
        </tbl>
        <tbl name="EmpEnrSum [InnerClause]" join="LEFT" to="Emp">
          <and>
            <eq>
              <fld name="EmpEnrSum.Emp" />
              <fld name="Emp.Emp" />
            </eq>
            <!-- 47409-LM-NV: Code Adde To Handle Multiple Eml With Same EnrTyp -->
            <eq>
              <fld name="EmpEnrSum.Eml" />
              <fld name="Eml.Eml" />
            </eq>
          </and>
        </tbl>
        <tbl name="EmpBenElg" main="Yes" join="RIGHT" to="EmpEnrSum">
          <and>
            <eq>
              <fld name="EmpEnrSum.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <eq>
              <fld name="EmpEnrSum.Eml" />
              <fld name="EmpBenElg.Eml" />
            </eq>
            <isnull>
              <fld name="EmpBenElgEfdDt" />
            </isnull>
            <eq>
              <fld name="EmpBenElg.Chosen" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="INNER">
          <and>
            <eq>
              <fld name="Ben.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="Ben.EnrSum" />
              <fld name="EnrSum.EnrSum" />
            </eq>
          </and>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="BenPln.PlanType" />
            <fld name="PlnTyp.PlnTyp" />
          </eq>
        </tbl>
        <!-- 47409-LM-NV: Join with PayGrp and Job table added to display in the header -->
        <tbl name="Job" join="LEFT" to="Eml">
          <and>
            <eq>
              <fld name="Eml.Job"/>
              <fld name="Job.Job"/>
            </eq>
            <isnull>
              <fld name="Job.JobEfdDt"/>
            </isnull>
          </and>
        </tbl>
        <tbl name="PayGrp" join="LEFT" to="Eml">
          <and>
            <eq>
              <fld name="Eml.PayGrp"/>
              <fld name="PayGrp.PayGrp"/>
            </eq>
            <isnull>
              <fld name="PayGrp.PayGrpEfdDt"/>
            </isnull>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpBenElg.*" />
        <fld name="EnrSum.EnrSum" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00' + Convert(varchar(15), PlnTyp.PlnOrd), 3)
            ]]>
          </native>
        </fld>
        <fld name="PlnTyp.PlnTypName" />
        <fld name="PlnTyp.PlnTypDesc" />
        <fld name="Ben.BenName" />
        <fld name="Ben.IsEmpPremEmpAmt" />
        <fld name="Ben.IsEmpCovEmpAmt" />
        <fld name="Ben.IsCmpPremEmpAmt" />
        <fld name="Ben.IsCmpCovEmpAmt" />
        <fld name="Ben.IsTotPremEmpAmt" />
        <fld name="Ben.IsTotCovEmpAmt" />
        <fld name="Ben.IsFlxCrdEmpAmt" />
        <fld name="EnrSum.EnrStartDt" />
        <fld name="EnrSum.EnrEndDt" />
        <fld name="Ben.BenDesc" />
        <fld name="BenPln.DescLnk" />
        <fld name="BenPln.InsCar" />
        <fld name="BenPln.FSAAllow" />
        <fld name="BenPln.FSADepAllow" />
        <fld name="BenPln.DepAllow" />
        <fld name="BenPln.BenAllow" />
        <fld name="BenPln.ClmAllow" />
        <fld name="BenPln.UntAllow" />
        <fld name="BenPln.PCPAllow" />
        <fld name="EmpName">
          <append>
            <fld name="Emp.LastName" type="String" />
            <val>, </val>
            <fld name="Emp.FirstName" type="String" />
          </append>
        </fld>
        <script name="EmpHeaderFlds" />
        <!-- 47409-LM-NV: Fields from Eml table added -->
        <script name="EmlHeaderFlds"/>
      </display>
  <where>
     <eq>
        <fld name="Emp.Emp" />
        <val>[EmpVal]</val>
     </eq>
  </where>
      <order>
        <fld name="EmpBenElg.Emp" />
        <fld name="Ben.EnrSum" />
        <!-- 47409-LM-NV: Added to sort the records based on Eml -->
        <fld name="EmlVal" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBenElg.Ben" />
      </order>
      <includehistory>Yes</includehistory>
    </dataset>
    <dataset name="Bnf">
      <tables>
        <tbl name="EmpDep" />
        <tbl name="EmpEnrSum [InnerClause]" join="LEFT" to="EmpDep">
          <and>
            <eq>
              <fld name="EmpEnrSum.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
          </and>
        </tbl>
        <!--
        <tbl name="EnrSum" join="LEFT" to="EmpEnrSum"><eq><fld name="EnrSum.EnrSum" /><fld name="EmpEnrSum.EnrSum" /></eq></tbl> 
        -->
        <tbl name="EmpBenElg" join="RIGHT" to="EmpEnrSum">
          <and>
            <eq>
              <fld name="EmpBenElg.Emp" />
              <fld name="EmpEnrSum.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElg.Eml" />
              <fld name="EmpEnrSum.Eml" />
            </eq>
            <eq>
              <fld name="EmpBenElg.Chosen" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <and>
            <eq>
              <fld name="Ben.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="Ben.EnrSum" />
              <fld name="EnrSum.EnrSum" />
            </eq>
          </and>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="PlnTyp.PlnTyp" />
            <fld name="BenPln.PlanType" />
          </eq>
        </tbl>
        <tbl name="EmpBenElgBnf" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="EmpBenElgBnf.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgBnf.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="EmpBenElgBnf.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgBnf.BnfNum" />
              <fld name="EmpDep.Dep" />
            </eq>
            <eq>
              <fld name="EmpDep.Beneficiary" type="YesNo" />
              <val type="YesNo">Yes</val>
            </eq>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpDep.Emp" />
        <fld name="EmpBenElg.Eml" />
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00' + Convert(varchar(15), PlnTyp.PlnOrd), 3)
            ]]>
          </native>
        </fld>
        <fld name="EnrSum.EnrSum" />
        <fld name="BnfPct" />
        <fld name="Contingency" />
        <fld name="EmpBenElgBnfEfdDt" />
        <fld name="EmpBenElgBnf.EmpBenElgBnfId" />
        <fld name="EmpBenElgBnf.EmpBenElgBnfDt" />
        <fld name="EmpBenElgBnf.BnfNum" />
        <fld name="BnfName">
          <append>
            <fld name="EmpDep.DepLastName" type="String" />
            <val>, </val>
            <fld name="EmpDep.DepFirstName" type="String" />
          </append>
        </fld>
        <fld name="BnfSelect">
          <native lang="SQLServer">
            CASE WHEN NOT EmpBenElgBnf.BnfNum IS NULL AND EmpBenElgBnf.EmpBenElgBnfEfdDt IS NULL THEN 'Yes' ELSE 'No' END 
          </native>
        </fld>
      </display>
      <where>
        <and>
          <eq>
            <fld name="EmpDep.Emp" type="String" />
            <val>[fld_main.Emp]</val>
          </eq>
          <eq>
            <fld name="EmpDep.Beneficiary" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="BenPln.BenAllow" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
        </and>
      </where>
      <order>
        <fld name="EmpBenElg.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
      </order>
      <synchronize dataset="main">
        <if>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
              <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnOrd]</val>
                <val>[fld_Bnf.PlnOrd]</val>
              </eq>
              <eq>
                <val>[fld_main.PlnTyp]</val>
                <val>[fld_Bnf.PlnTyp]</val>
              </eq>
              <eq>
                <val>[fld_main.Ben]</val>
                <val>[fld_Bnf.Ben]</val>
              </eq>
            </and>
          </when>
          <then>Keep</then>
          <when>
            <and>
              <eq>
                <val>[fld_main.Emp]</val>
                <val>[fld_Bnf.Emp]</val>
              </eq>
          <gt>
            <val>[fld_main.EnrSum]</val>
            <val>[fld_Bnf.EnrSum]</val>
          </gt>
          <eq>
            <val>[fld_main.PlnOrd]</val>
            <val>[fld_Bnf.PlnOrd]</val>
          </eq>
          <eq>
            <val>[fld_main.PlnTyp]</val>
            <val>[fld_Bnf.PlnTyp]</val>
          </eq>
          <eq>
            <val>[fld_main.Ben]</val>
            <val>[fld_Bnf.Ben]</val>
          </eq>
        </and>
      </when>
      <then>Skip</then>
      <when>
        <and>
          <eq>
            <val>[fld_main.Emp]</val>
            <val>[fld_Bnf.Emp]</val>
          </eq>
          <eq>
                <val>[fld_main.EnrSum]</val>
                <val>[fld_Bnf.EnrSum]</val>
              </eq>
          <gt>
            <val>[fld_main.PlnOrd]</val>
            <val>[fld_Bnf.PlnOrd]</val>
          </gt>
          <eq>
            <val>[fld_main.PlnTyp]</val>
            <val>[fld_Bnf.PlnTyp]</val>
          </eq>
          <eq>
            <val>[fld_main.Ben]</val>
            <val>[fld_Bnf.Ben]</val>
          </eq>
        </and>
      </when>
      <then>Skip</then>
      <when>
        <and>
          <eq>
            <val>[fld_main.Emp]</val>
            <val>[fld_Bnf.Emp]</val>
          </eq>
          <eq>
            <val>[fld_main.EnrSum]</val>
            <val>[fld_Bnf.EnrSum]</val>
          </eq>
          <eq>
                  <val>[fld_main.PlnOrd]</val>
                  <val>[fld_Bnf.PlnOrd]</val>
          </eq>
          <gt>
            <val>[fld_main.PlnTyp]</val>
            <val>[fld_Bnf.PlnTyp]</val>
          </gt>
          <eq>
            <val>[fld_main.Ben]</val>
            <val>[fld_Bnf.Ben]</val>
          </eq>
        </and>
      </when>
      <then>Skip</then>
      <when>
        <and>
          <eq>
            <val>[fld_main.Emp]</val>
            <val>[fld_Bnf.Emp]</val>
          </eq>
          <eq>
            <val>[fld_main.EnrSum]</val>
            <val>[fld_Bnf.EnrSum]</val>
          </eq>
          <eq>
            <val>[fld_main.PlnOrd]</val>
            <val>[fld_Bnf.PlnOrd]</val>
          </eq>
          <eq>
            <val>[fld_main.PlnTyp]</val>
            <val>[fld_Bnf.PlnTyp]</val>
          </eq>
          <gt>
            <val>[fld_main.Ben]</val>
            <val>[fld_Bnf.Ben]</val>
          </gt>
        </and>
      </when>
      <then>Skip</then>
      <else>Stop</else>
        </if>
      </synchronize>
      <includehistory>Yes</includehistory>
    </dataset>

    <dataset name="Dep">
      <tables>
        <tbl name="EmpDep" />
        <tbl name="EmpEnrSum [InnerClause]" join="LEFT" to="EmpDep">
          <and>
            <eq>
              <fld name="EmpEnrSum.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <!-- <in>
              <fld name="EmpEnrSum.EnrSum" />
              <dataset>
                <tables>
                  <tbl name="EnrSum" />
                </tables>
                <display>
                  <fld name="EnrSum" />
                </display>
                <where>
                  [JoinClause]
                </where>
                <includehistory>Yes</includehistory>
              </dataset>
            </in> -->
          </and>
        </tbl>
        <!--
        <tbl name="EnrSum" join="LEFT" to="EmpEnrSum"><eq><fld name="EnrSum.EnrSum" /><fld name="EmpEnrSum.EnrSum" /></eq></tbl> 
        -->
        <tbl name="EmpBenElg" join="RIGHT" to="EmpEnrSum">
          <and>
            <eq>
              <fld name="EmpBenElg.Emp" />
              <fld name="EmpEnrSum.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElg.Eml" />
              <fld name="EmpEnrSum.Eml" />
            </eq>
            <eq>
              <fld name="EmpBenElg.Chosen" type="YesNo" />
              <val>Yes</val>
            </eq>
          </and>
        </tbl>
        <tbl name="Ben" join="LEFT">
          <and>
            <eq>
              <fld name="Ben.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="Ben.EnrSum" />
              <fld name="EnrSum.EnrSum" />
            </eq>
          </and>
        </tbl>
        <tbl name="BenPln" join="LEFT">
          <eq>
            <fld name="BenPln.BenPln" />
            <fld name="Ben.BenPln" />
          </eq>
        </tbl>
        <tbl name="PlnTyp" join="LEFT">
          <eq>
            <fld name="PlnTyp.PlnTyp" />
            <fld name="BenPln.PlanType" />
          </eq>
        </tbl>
        <tbl name="EmpBenElgDep" main="Yes" join="LEFT">
          <and>
            <eq>
              <fld name="EmpBenElgDep.Emp" />
              <fld name="EmpBenElg.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgDep.Ben" />
              <fld name="EmpBenElg.Ben" />
            </eq>
            <eq>
              <fld name="EmpBenElgDep.Emp" />
              <fld name="EmpDep.Emp" />
            </eq>
            <eq>
              <fld name="EmpBenElgDep.Dep" />
              <fld name="EmpDep.Dep" />
            </eq>
            <eq>
              <fld name="EmpDep.Dependent" type="YesNo" />
              <val type="YesNo">Yes</val>
            </eq>
            <eq>
              <fld name="EmpDep.BenPart" type="YesNo" />
              <val type="YesNo">Yes</val>
            </eq>
          </and>
        </tbl>
      </tables>
      <display>
        <fld name="EmpDep.Emp" />
        <fld name="EmpBenElg.Eml" />
        <fld name="EnrSum.EnrSum" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="PlnTyp.PlnOrd">
          <native lang="SQLServer">
            <![CDATA[
              RIGHT('00' + Convert(varchar(15), PlnTyp.PlnOrd), 3)
            ]]>
          </native>
        </fld>
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
        <fld name="DepPhysician" />
        <fld name="EmpBenElgDepEffDt" />
        <fld name="EmpBenElgDepEfdDt" />
        <fld name="DepBenStartDt" />
        <fld name="DepBenEndDt" />
        <fld name="EmpBenElgDep.EmpBenElgDepId" />
        <fld name="EmpBenElgDep.EmpBenElgDepDt" />
        <fld name="DepName">
          <append>
            <fld name="EmpDep.DepLastName" type="String" />
            <val>, </val>
            <fld name="EmpDep.DepFirstName" type="String" />
          </append>
        </fld>
        <fld name="DepSelect">
          <native lang="SQLServer">
            CASE WHEN NOT EmpBenElgDep.Dep IS NULL AND EmpBenElgDep.EmpBenElgDepEfdDt IS NULL THEN 'Yes' ELSE 'No' END 
          </native>
        </fld>
      </display>
      <where>
        <and xml="keep">
          <eq>
            <fld name="EmpDep.Emp" type="String" />
            <val>[fld_main.Emp]</val>
          </eq>
          <eq>
            <fld name="EmpDep.Dependent" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="EmpDep.BenPart" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
          <eq>
            <fld name="BenPln.DepAllow" type="YesNo" />
            <val type="YesNo">Yes</val>
          </eq>
        </and>
      </where>
      <order>
        <fld name="EmpBenElg.Emp" />
        <fld name="Ben.EnrSum" />
        <fld name="PlnTyp.PlnOrd" />
        <fld name="PlnTyp.PlnTyp" />
        <fld name="EmpBenElg.Ben" />
        <fld name="EmpDep.Dep" />
      </order>
  <synchronize dataset="main">
      <if>
        <when>
          <and>
            <eq><val>[fld_main.Emp]</val><val>[fld_Dep.Emp]</val></eq>
            <eq><val>[fld_main.EnrSum]</val><val>[fld_Dep.EnrSum]</val></eq>
            <eq><val>[fld_main.PlnOrd]</val><val>[fld_Dep.PlnOrd]</val></eq>
            <eq><val>[fld_main.PlnTyp]</val><val>[fld_Dep.PlnTyp]</val></eq>
            <eq><val>[fld_main.Ben]</val><val>[fld_Dep.Ben]</val></eq>
          </and>
        </when>
        <then>Keep</then>
        <when>
          <and>
            <eq><val>[fld_main.Emp]</val><val>[fld_Dep.Emp]</val></eq>
            <gt><val>[fld_main.EnrSum]</val><val>[fld_Dep.EnrSum]</val></gt>
            <eq><val>[fld_main.PlnOrd]</val><val>[fld_Dep.PlnOrd]</val></eq>
            <eq><val>[fld_main.PlnTyp]</val><val>[fld_Dep.PlnTyp]</val></eq>
            <eq><val>[fld_main.Ben]</val><val>[fld_Dep.Ben]</val></eq>
          </and>
        </when>
      <then>Skip</then>
      <when>
        <and>
          <eq><val>[fld_main.Emp]</val><val>[fld_Dep.Emp]</val></eq>
          <eq><val>[fld_main.EnrSum]</val><val>[fld_Dep.EnrSum]</val></eq>
          <gt><val>[fld_main.PlnOrd]</val><val>[fld_Dep.PlnOrd]</val></gt>
          <eq><val>[fld_main.PlnTyp]</val><val>[fld_Dep.PlnTyp]</val></eq>
          <eq><val>[fld_main.Ben]</val><val>[fld_Dep.Ben]</val></eq>
        </and>
      </when>
      <then>Skip</then>
      <when>
        <and>
          <eq><val>[fld_main.Emp]</val><val>[fld_Dep.Emp]</val></eq>
          <eq><val>[fld_main.EnrSum]</val><val>[fld_Dep.EnrSum]</val></eq>
          <eq><val>[fld_main.PlnOrd]</val><val>[fld_Dep.PlnOrd]</val></eq>
          <gt><val>[fld_main.PlnTyp]</val><val>[fld_Dep.PlnTyp]</val></gt>
          <eq><val>[fld_main.Ben]</val><val>[fld_Dep.Ben]</val></eq>
        </and>
      </when>
      <then>Skip</then>
      <when>
        <and>
          <eq><val>[fld_main.Emp]</val><val>[fld_Dep.Emp]</val></eq>
          <eq><val>[fld_main.EnrSum]</val><val>[fld_Dep.EnrSum]</val></eq>
          <eq><val>[fld_main.PlnOrd]</val><val>[fld_Dep.PlnOrd]</val></eq>
          <eq><val>[fld_main.PlnTyp]</val><val>[fld_Dep.PlnTyp]</val></eq>
          <gt><val>[fld_main.Ben]</val><val>[fld_Dep.Ben]</val></gt>
        </and>
      </when>
      <then>Skip</then>
      <else>Stop</else>
        </if>
    </synchronize>
      <includehistory>Yes</includehistory>
    </dataset>
<dataset name="EmpDS">
  <tables>
    <tbl name="Emp" main="Yes"/>
   </tables>
   <display>
     <fld name="Emp.Emp" />
   </display>
   <where>
      <eq>
        <fld name="Emp.EmpId" />
        <val>[NavID]</val>
      </eq>
   </where>
</dataset>

<dataset name="PrimContingent">
  <cols>2</cols>
  <r>
    <c>No</c>
    <c>Primary</c>
  </r>
  <r>
    <c>Yes</c>
    <c>Contingent</c>
  </r>
</dataset>

    <dataset name="BnfUpdate">
      <tables>
        <tbl name="EmpBenElgBnf" main="Yes" />
      </tables>
      <display>
        <fld name="EmpBenElgBnfId" key="Yes" />
        <fld name="Emp" key="Yes" />
        <fld name="Eml" key="Yes" />
        <fld name="Ben" key="Yes" />
        <fld name="BnfNum" key="Yes" />
        <fld name="EmpBenElgBnfEffDt" />
        <fld name="Contingency" />
        <fld name="BnfPct" />
      </display>
    </dataset>
    <dataset name="DepUpdate">
      <tables>
        <tbl name="EmpBenElgDep" main="Yes" />
      </tables>
      <display>
        <fld name="EmpBenElgDepId" key="Yes" />
        <fld name="Emp" key="Yes" />
        <fld name="Eml" key="Yes" />
        <fld name="Ben" key="Yes" />
        <fld name="Dep" key="Yes" />
        <fld name="EmpBenElgDepEffDt" />
        <fld name="DepPhysician" />
        <fld name="DepBenEligibleDt" />
      </display>
    </dataset>
  <!-- Dataset Defintion Block Ends -->
  <!-- View Definiton Block Starts -->
    <view name="list">
      <script name="EmpHeaderCtls" />
      <!-- 47409-LM-NV: Eml Header Controls script added -->
      <script name="EmlHeaderCtls" />
      <display>
        <title>Employee Open Enrollment Benefits Dependents / Beneficiaries Details</title>
        <instructions>Choose Dependents / Beneficiaries</instructions>
        <head />
        <toolbar>
          <save />
        </toolbar>
        <body>
          <if>
            <when>
              <eq>
                <val>[F_Application]</val>
                <val>ESS</val>
              </eq>
            </when>
            <then>
              <set var="[varReadonly]">Yes</set>
            </then>
            <else>
              <set var="[varReadonly]">No</set>
            </else>
          </if>
          <datasheet dataset="main" headers="TOP" showlinecount="No">
            <groups>
              <groupby val="[fld_Emp]">
                <header>
                  <row>
                    <col>[ctl_EmpName]</col>
                    <col>[ctl_ProfilePopup]</col>
                  </row>
                </header>
              </groupby>
              <groupby val="[fld_EnrSum]">
                <if>
                  <when>
                    <ne>
                      <val>[fld_EnrSum]</val>
                      <val />
                    </ne>
                  </when>
                  <then>
                    <header>
                      <row>
                        <col>[ctl_EnrSum]</col>
                      </row>
                    </header>
                  </then>
                </if>
              </groupby>
              <!-- 
                # 47409-LM-NV: Groupby Eml header for benefit screens added
              -->
              <script name="BenFrmEmlHdrGrp" />
              <groupby val="[fld_PlnTyp]">
                <if>
                  <when>
                    <ne>
                      <val>[fld_PlnTyp]</val>
                      <val />
                    </ne>
                  </when>
                  <then>
                    <header>
                      <row>
                        <col>[ctl_PlnTypName]</col>
                      </row>
                      <if when="[fld_PlnTypDesc]">
                        <row>
                          <col>[ctl_PlnTypDesc]</col>
                        </row>
                      </if>
                    </header>
                  </then>
                </if>
              </groupby>
            </groups>
            <if>
              <when>
                <ne>
                  <val>[fld_PlnTyp]</val>
                  <val />
                </ne>
              </when>
              <then>
                <row>
                  <set var="[ExtraColumns]">9</set>
                  <if>
                    <when>
                      <eq>
                        <val>[fld_main.PendBen]</val>
                        <val>Yes</val>
                      </eq>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col>[ctl_PendBen]</col>
                    </then>
                  </if>
                  <col>[ctl_BenName]</col>
                  <col>[ctl_InsCar]</col>
                  <col>[ctl_EmpBenElgDedStartDt]</col>
                  <col>[ctl_EmpBenElgDedEndDt]</col>
                  <if>
                    <when>
                      <eq>
                        <val>[fld_main.IsCmpCovEmpAmt]</val>
                        <val>Yes</val>
                      </eq>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col align="RIGHT">[ctl_CmpCov]</col>
                    </then>
                    <else>
                      <if>
                        <when>
                          <gt>
                            <val>[fld_main.CmpCov]</val>
                            <val>0</val>
                          </gt>
                        </when>
                        <then>
                          <set var="[ExtraColumns]">
                            <minus>
                              <val>[ExtraColumns]</val>
                              <val>1</val>
                            </minus>
                          </set>
                          <col align="RIGHT">[ctl_CmpCovLbl]</col>
                        </then>
                      </if>
                    </else>
                  </if>
                  <if>
                    <when>
                      <eq>
                        <val>[fld_main.IsEmpCovEmpAmt]</val>
                        <val>Yes</val>
                      </eq>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col align="RIGHT">[ctl_EmpCov]</col>
                    </then>
                    <else>
                      <if>
                        <when>
                          <gt>
                            <val>[fld_main.EmpCov]</val>
                            <val>0</val>
                          </gt>
                        </when>
                        <then>
                          <set var="[ExtraColumns]">
                            <minus>
                              <val>[ExtraColumns]</val>
                              <val>1</val>
                            </minus>
                          </set>
                          <col align="RIGHT">[ctl_EmpCovLbl]</col>
                        </then>
                      </if>
                    </else>
                  </if>
    <!-- 
    <if>
    <when>
    <ne><val>[F_Application]</val><val>ESS</val></ne>
    </when>
    <then>
    --> 
   
                  <set var="[ExtraColumns]">
                    <minus>
                      <val>[ExtraColumns]</val>
                      <val>1</val>
                    </minus>
                  </set>
                  <if>
                    <when>
                      <and>
                        <eq>
                          <val>[fld_main.IsCmpPremEmpAmt]</val>
                          <val>Yes</val>
                        </eq>
                        <ne>
                          <val>[F_Application]</val>
                          <val>ESS</val>
                        </ne>
                      </and>
                    </when>
                    <then>
                      <col align="RIGHT">[ctl_CmpPrem]</col>
                    </then>
                    <else>
                      <col align="RIGHT">[ctl_CmpPremLbl]</col>
                    </else>
                  </if>
    <!--
    </then>
    </if> 
    -->
   
                  
                  <if>
                    <when>
                      <and>
                        <eq>
                          <val>[fld_main.IsEmpPremEmpAmt]</val>
                          <val>Yes</val>
                        </eq>
                        <ne>
                          <val>[F_Application]</val>
                          <val>ESS</val>
                        </ne>
                      </and>
                    </when>
                    <then>
                      <col align="RIGHT">[ctl_EmpPrem]</col>
                    </then>
                    <else>
                      <col align="RIGHT">[ctl_EmpPremLbl]</col>
                    </else>
                  </if>
                  <if>
                    <when>
                      <eq>
                        <val>[fld_main.IsFlxCrdEmpAmt]</val>
                        <val>Yes</val>
                      </eq>
                    </when>
                    <then>
                      <set var="[ExtraColumns]">
                        <minus>
                          <val>[ExtraColumns]</val>
                          <val>1</val>
                        </minus>
                      </set>
                      <col align="RIGHT">[ctl_FlexCredits]</col>
                    </then>
                    <else>
                      <if>
                        <when>
                          <gt>
                            <val>[fld_main.FlexCredits]</val>
                            <val>0</val>
                          </gt>
                        </when>
                        <then>
                          <set var="[ExtraColumns]">
                            <minus>
                              <val>[ExtraColumns]</val>
                              <val>1</val>
                            </minus>
                          </set>
                          <col align="RIGHT">[ctl_FlexCreditsLbl]</col>
                        </then>
                      </if>
                    </else>
                  </if>
                  <if when="[fld_main.FSAAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <col>[ctl_AnnElectAmt]</col>
                  </if>
                  <!-- Event 36177-LM-NV -->
                  <if when="[fld_main.FSADepAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <col>[ctl_DepAnnElectAmt]</col>
                  </if>
                  <if when="[fld_main.UntAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <col align="RIGHT">[ctl_Units]</col>
                  </if>
                  <if when="[fld_main.PCPAllow]">
                    <set var="[ExtraColumns]">
                      <minus>
                        <val>[ExtraColumns]</val>
                        <val>1</val>
                      </minus>
                    </set>
                    <col>[ctl_Physician]</col>
                  </if>
                  <if>
                    <when>
                      <gt>
                        <val>[ExtraColumns]</val>
                        <val>0</val>
                      </gt>
                    </when>
                    <then>
                      <col span="[ExtraColumns]" />
                    </then>
                  </if>
                </row>
                <if when="[fld_main.DepAllow]">
                  <set var="[isPCPAllow]" />
                  <if when="[fld_main.PCPAllow]">
                    <set var="[isPCPAllow]">Yes</set>
                  </if>
                  <row>
                    <col span="10">
                      <datasheet dataset="Dep" headers="TOP" showlinecount="No">
                        <row>
                          <col>[ctl_SysDepSelect][ctl_Dep][ctl_Emp][ctl_Eml][ctl_Ben][ctl_EmpBenElgEffDt][ctl_EligibleDt][ctl_SysElgDepId]</col>
                          <col>[ctl_DepName]</col>
                          <if>
                            <when>
                              <eq>
                                <val>[isPCPAllow]</val>
                                <val>Yes</val>
                              </eq>
                            </when>
                            <then>
                              <set var="[ExtraColumns]">
                                <minus>
                                  <val>[ExtraColumns]</val>
                                  <val>1</val>
                                </minus>
                              </set>
                              <col>[ctl_DepPhysician]</col>
                            </then>
                          </if>
                        </row>
                      </datasheet>
                    </col>
                  </row>
                </if>
                <if when="[fld_main.BenAllow]">
                  <row>
                    <col span="10">
                      <datasheet dataset="Bnf" headers="TOP" showlinecount="No">
                        <row>
                          <col>[ctl_SysBnfSelect][ctl_BnfNum][ctl_Emp][ctl_Eml][ctl_Ben][ctl_EmpBenElgEffDt][ctl_SysElgBnfId]</col>
                          <col>[ctl_BnfName]</col>
                          <col>[ctl_Contingency]</col>
                          <col>[ctl_BnfPct]</col>
                        </row>
                      </datasheet>
                    </col>
                  </row>
                </if>
                <set var="[NoSelection]">No</set>
              </then>
              <else>
                <set var="[NoSelection]">Yes</set>
              </else>
            </if>
          </datasheet>
          <if when="[NoSelection]">
            <v>Employee has not chosen any Benefits</v>
          </if>
        </body>
      </display>
    </view>
  <!-- View Defnition Block Ends -->
<!-- Form EmpBenElgDepRvw Ends -->