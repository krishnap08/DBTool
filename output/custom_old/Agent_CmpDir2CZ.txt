CREATE VIEW CmpDir2CZ AS
SELECT ZZEmp.EmpId AS CmpDir2CZId, ZZEmp.EmpEffDt AS CmpDir2CZEffDt, ZZEmp.EmpEfdDt AS CmpDir2CZEfdDt, ZZEmp.EmpId, ZZEmp.Emp, ZZEmp.FirstName, ZZEmp.NickName, ZZEmp.EmailHome, ZZEmp.PrimaryEmailCZ, ZZEmp.LastName, ZZEmp.EMailWork, ZZEml.EmpSts, convert(varchar(10),ZZEmp.HireDt,101) AS HireDt, convert(varchar(10),ZZEmp.TerminationDt,101) AS TerminationDt, (select (p.Emp + ' - ' + p.FirstName + ' ' + p.LastName) from ZZEmp p where p.Emp = ZZEml.Sup) AS Supervisor, (select job.JobTitle from ZZJob job where job.Job = ZZEml.Job) AS JobTitle, (select loc.LocName from ZZLoc loc where loc.Loc = ZZEml.Loc) AS LocName, (select org.OrgName from ZZOrg org where org.Org = ZZEml.Org) AS OrgName, (select (p2.Emp + ' - ' + p2.FirstName + ' ' + p2.LastName) from ZZEmp p2 where p2.Emp = ZZEml.HrMgrCZ) AS HRMgrCZ, ZZEml.Cmp, ZZEml.Div, ZZEml.Dpt, ZZEml.Loc
FROM ZZEmp INNER JOIN ZZEml ON ZZEmp.Emp = ZZEml.Emp AND ZZEml.EmlEfdDt IS NULL AND ZZEml.IsPrm = 1